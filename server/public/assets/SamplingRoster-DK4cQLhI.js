import{d as ct,a as x,l as Ee,p as ye,f as z,u as X,e as a,g as pe,t as R,b as $,h as J,F as Re,i as Ce,s as We,x as Ct,r as A,c as qe,K as st,o as Mt,U as It,I as At,w as W,z as ve,n as Ue,v as rt,G as He}from"./index-BDXnSKSk.js";import{C as Le}from"./component-BONIvnTK.js";import{_ as _t}from"./AdminLayout.vue_vue_type_script_setup_true_lang-D4scmcBy.js";import{_ as Et}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CpoPOzAJ.js";import{_ as nt}from"./ComponentCard.vue_vue_type_script_setup_true_lang-B4SXyZ5T.js";import{d as Be,C as Nt}from"./ConfirmationModal-B4Hc4NNx.js";import{W as jt}from"./InfoCircleIcon-CENELyWH.js";import{Y as Vt,h as ot,G as Ut,V as Bt,S as Yt}from"./transition-DniDJg0f.js";import{i as Wt,s as Pt,h as Jt,u as zt}from"./shipNominationService-yFTxIJ85.js";import{l as Ke}from"./molekulisLoadingService-CZtx6X1S.js";import{l as Ze}from"./otherJobsService-BBK8tmk7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Gt={class:"fixed inset-0 overflow-y-auto"},qt={class:"flex min-h-full items-center justify-center p-4"},Kt={class:"px-5 pt-4 pb-3 border-b border-gray-200 dark:border-gray-700"},Zt={class:"flex items-center gap-3 mb-2"},Xt={class:"flex h-10 w-10 items-center justify-center rounded-full bg-orange-100 dark:bg-orange-900/30"},Qt={class:"text-gray-600 dark:text-gray-400 text-sm ml-[52px]"},ea={class:"px-5 py-3 space-y-3 overflow-y-auto flex-1"},ta={class:"rounded-lg border-2 border-orange-200 dark:border-orange-800 bg-orange-50 dark:bg-orange-900/20 p-3"},aa={class:"text-sm text-orange-800 dark:text-orange-300"},sa={key:0,class:"rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 p-3"},ra={class:"grid grid-cols-2 gap-3 text-xs"},na={class:"font-medium text-gray-900 dark:text-white text-sm"},oa={class:"font-medium text-gray-900 dark:text-white text-sm"},ia={key:0,class:"col-span-2 flex justify-between"},la={class:"font-medium text-gray-900 dark:text-white"},ua={key:1,class:"col-span-2 flex justify-between"},da={class:"font-medium text-gray-900 dark:text-white"},ca={class:"rounded-lg border-2 border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 p-3"},ga={class:"grid grid-cols-2 gap-3 text-xs"},fa={class:"font-medium text-blue-900 dark:text-blue-100 text-sm"},pa={class:"font-medium text-blue-900 dark:text-blue-100 text-sm"},ma={key:0,class:"col-span-2 flex justify-between"},ha={class:"font-medium text-blue-900 dark:text-blue-100"},va={key:1,class:"rounded-lg border border-yellow-200 dark:border-yellow-800 bg-yellow-50 dark:bg-yellow-900/20 p-2.5"},ya={class:"flex items-center gap-2"},Sa={class:"text-xs font-medium text-yellow-900 dark:text-yellow-200"},wa={key:2,class:"rounded-lg border-2 border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20 p-3"},ba={class:"mb-3 space-y-1.5"},xa={class:"flex justify-between items-center text-xs"},ka={class:"font-semibold text-red-900 dark:text-red-100"},Da={class:"flex justify-between items-center text-xs"},$a={class:"font-semibold text-red-900 dark:text-red-100"},Ta={class:"flex justify-between items-center text-xs pt-1.5 border-t border-red-200 dark:border-red-800"},Ha={class:"font-bold text-red-900 dark:text-red-100 text-base"},La={class:"flex justify-between items-center text-xs"},Oa={class:"font-semibold text-red-900 dark:text-red-100"},Ra={key:0,class:"mt-2"},Fa={class:"max-h-32 overflow-y-auto space-y-1.5 custom-scrollbar"},Ca={class:"grid grid-cols-2 gap-1.5 mb-1"},Ma={class:"font-medium text-gray-900 dark:text-white text-xs"},Ia={class:"font-medium text-gray-900 dark:text-white text-xs"},Aa={class:"flex justify-between items-center gap-2"},_a={class:"font-medium text-gray-900 dark:text-white"},Ea={class:"flex justify-between items-center"},Na={class:"font-semibold text-gray-900 dark:text-white"},ja=ct({__name:"SamplerConflictModal",props:{isOpen:{type:Boolean},conflictData:{}},emits:["override","close"],setup(f,{emit:u}){const p=u,k=l=>{if(!l)return"-";const i=typeof l=="string"?new Date(l):l;return isNaN(i.getTime())?"-":i.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1})},D=()=>{p("override"),w()},w=()=>{p("close")};return(l,i)=>(x(),Ee(X(Yt),{show:l.isOpen,as:"template"},{default:ye(()=>[z(X(Vt),{as:"div",class:"relative z-[99999]",onClose:w},{default:ye(()=>[z(X(ot),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:ye(()=>i[0]||(i[0]=[a("div",{class:"fixed inset-0 bg-black/70 backdrop-blur-md transition-opacity"},null,-1)])),_:1}),a("div",Gt,[a("div",qt,[z(X(ot),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 scale-95 translate-y-4","enter-to":"opacity-100 scale-100 translate-y-0",leave:"ease-in duration-200","leave-from":"opacity-100 scale-100 translate-y-0","leave-to":"opacity-0 scale-95 translate-y-4"},{default:ye(()=>[z(X(Ut),{class:"w-full max-w-2xl transform overflow-hidden rounded-2xl bg-white dark:bg-gray-800 shadow-2xl transition-all max-h-[90vh] flex flex-col"},{default:ye(()=>{var m,B,C,L,b,S,j,M,_,O,N,Q,se,de,H,Y,F,G,ee,le,U,E,ue,Oe,ce,we,me,re,V;return[a("div",Kt,[a("div",Zt,[a("div",Xt,[z(X(jt),{class:"h-5 w-5 text-orange-600 dark:text-orange-400"})]),z(X(Bt),{class:"text-xl font-bold text-gray-900 dark:text-white"},{default:ye(()=>i[1]||(i[1]=[pe(" Sampler Conflict Detected ")])),_:1})]),a("p",Qt,R((m=l.conflictData)==null?void 0:m.samplerName)+" has a scheduling conflict. Review the details below to proceed with override. ",1)]),a("div",ea,[a("div",ta,[i[2]||(i[2]=a("div",{class:"flex items-center gap-2 mb-1"},[a("svg",{class:"h-4 w-4 text-orange-600 dark:text-orange-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),a("span",{class:"text-sm font-semibold text-orange-900 dark:text-orange-200"},"Conflict Type:")],-1)),a("p",aa,R((B=l.conflictData)==null?void 0:B.reason),1)]),(C=l.conflictData)!=null&&C.previousShift?(x(),$("div",sa,[i[7]||(i[7]=a("div",{class:"flex items-center gap-2 mb-2"},[a("svg",{class:"h-4 w-4 text-gray-600 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),a("span",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Previous Shift")],-1)),a("div",ra,[a("div",null,[i[3]||(i[3]=a("span",{class:"text-gray-600 dark:text-gray-400"},"Start:",-1)),a("p",na,R(k(((L=l.conflictData.previousShift)==null?void 0:L.start)||"")),1)]),a("div",null,[i[4]||(i[4]=a("span",{class:"text-gray-600 dark:text-gray-400"},"End:",-1)),a("p",oa,R(k(((b=l.conflictData.previousShift)==null?void 0:b.end)||"")),1)]),(j=(S=l.conflictData)==null?void 0:S.previousShift)!=null&&j.duration?(x(),$("div",ia,[i[5]||(i[5]=a("span",{class:"text-gray-600 dark:text-gray-400"},"Duration:",-1)),a("span",la,R(l.conflictData.previousShift.duration),1)])):J("",!0),(_=(M=l.conflictData)==null?void 0:M.previousShift)!=null&&_.source?(x(),$("div",ua,[i[6]||(i[6]=a("span",{class:"text-gray-600 dark:text-gray-400"},"Source:",-1)),a("span",da,R(l.conflictData.previousShift.source),1)])):J("",!0)])])):J("",!0),a("div",ca,[i[11]||(i[11]=a("div",{class:"flex items-center gap-2 mb-2"},[a("svg",{class:"h-4 w-4 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})]),a("span",{class:"text-sm font-semibold text-blue-900 dark:text-blue-200"},"Proposed Shift")],-1)),a("div",ga,[a("div",null,[i[8]||(i[8]=a("span",{class:"text-blue-700 dark:text-blue-300"},"Start:",-1)),a("p",fa,R(k(((N=(O=l.conflictData)==null?void 0:O.proposedShift)==null?void 0:N.start)||"")),1)]),a("div",null,[i[9]||(i[9]=a("span",{class:"text-blue-700 dark:text-blue-300"},"End:",-1)),a("p",pa,R(k(((se=(Q=l.conflictData)==null?void 0:Q.proposedShift)==null?void 0:se.end)||"")),1)]),(H=(de=l.conflictData)==null?void 0:de.proposedShift)!=null&&H.duration?(x(),$("div",ma,[i[10]||(i[10]=a("span",{class:"text-blue-700 dark:text-blue-300"},"Duration:",-1)),a("span",ha,R(l.conflictData.proposedShift.duration),1)])):J("",!0)])]),((Y=l.conflictData)==null?void 0:Y.restHours)!==void 0?(x(),$("div",va,[a("div",ya,[i[12]||(i[12]=a("svg",{class:"h-4 w-4 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),a("span",Sa," Rest Period: "+R((G=(F=l.conflictData)==null?void 0:F.restHours)==null?void 0:G.toFixed(1))+"h (Minimum 10h required) ",1)])])):J("",!0),(ee=l.conflictData)!=null&&ee.weeklyHoursDetails?(x(),$("div",wa,[i[22]||(i[22]=a("div",{class:"flex items-center gap-2 mb-2"},[a("svg",{class:"h-4 w-4 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),a("span",{class:"text-sm font-semibold text-red-900 dark:text-red-200"},"Weekly Hours Limit Exceeded")],-1)),a("div",ba,[a("div",xa,[i[13]||(i[13]=a("span",{class:"text-red-700 dark:text-red-300"},"Current hours this week:",-1)),a("span",ka,R((U=(le=l.conflictData.weeklyHoursDetails)==null?void 0:le.currentHours)==null?void 0:U.toFixed(1))+"h",1)]),a("div",Da,[i[14]||(i[14]=a("span",{class:"text-red-700 dark:text-red-300"},"Proposed shift hours:",-1)),a("span",$a,R((ue=(E=l.conflictData.weeklyHoursDetails)==null?void 0:E.proposedHours)==null?void 0:ue.toFixed(1))+"h",1)]),a("div",Ta,[i[15]||(i[15]=a("span",{class:"text-red-800 dark:text-red-200 font-semibold"},"Total would be:",-1)),a("span",Ha,R((ce=(Oe=l.conflictData.weeklyHoursDetails)==null?void 0:Oe.totalHours)==null?void 0:ce.toFixed(1))+"h",1)]),a("div",La,[i[16]||(i[16]=a("span",{class:"text-red-700 dark:text-red-300"},"Maximum allowed:",-1)),a("span",Oa,R((we=l.conflictData.weeklyHoursDetails)==null?void 0:we.maxHours)+"h",1)])]),(re=(me=l.conflictData)==null?void 0:me.weeklyHoursDetails)!=null&&re.existingShifts&&l.conflictData.weeklyHoursDetails.existingShifts.length>0?(x(),$("div",Ra,[i[21]||(i[21]=a("p",{class:"text-xs font-medium text-red-900 dark:text-red-200 mb-1.5"},"Existing shifts this week:",-1)),a("div",Fa,[(x(!0),$(Re,null,Ce(((V=l.conflictData.weeklyHoursDetails)==null?void 0:V.existingShifts)||[],(be,Pe)=>(x(),$("div",{key:Pe,class:"rounded-md border border-red-200 dark:border-red-800 bg-white dark:bg-gray-800 p-2 text-xs"},[a("div",Ca,[a("div",null,[i[17]||(i[17]=a("span",{class:"text-gray-600 dark:text-gray-400"},"Start:",-1)),a("p",Ma,R(k(be.start)),1)]),a("div",null,[i[18]||(i[18]=a("span",{class:"text-gray-600 dark:text-gray-400"},"End:",-1)),a("p",Ia,R(k(be.end)),1)])]),a("div",Aa,[i[19]||(i[19]=a("span",{class:"text-gray-600 dark:text-gray-400"},"Source:",-1)),a("span",_a,R(be.source),1)]),a("div",Ea,[i[20]||(i[20]=a("span",{class:"text-gray-600 dark:text-gray-400"},"Duration:",-1)),a("span",Na,R(be.duration.toFixed(1))+"h",1)])]))),128))])])):J("",!0)])):J("",!0)]),a("div",{class:"px-5 py-3 border-t border-gray-200 dark:border-gray-700 flex gap-2"},[a("button",{onClick:w,class:"flex-1 rounded-lg border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-200"}," Cancel "),a("button",{onClick:D,class:"flex-1 rounded-lg px-4 py-2 text-sm font-semibold text-white bg-orange-600 hover:bg-orange-700 transition-all duration-200"}," Override & Continue ")])]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}}),Ne=12,P=7,te=19,gt=10,it=24;function Ye(f){const u=new Date(f),p=u.getDay(),k=u.getDate()-p+(p===0?-6:1),D=new Date(u.setDate(k));D.setHours(0,0,0,0);const w=new Date(D);return w.setDate(D.getDate()+6),w.setHours(23,59,59,999),{start:D,end:w}}function Va(f,u){const p=f.getDay();return u.includes(p)}function Ua(f,u){const p=new Date(f.start),k=new Date(f.end),D=new Date(p);for(D.setHours(0,0,0,0);D<=k;){if(Va(D,u))return!0;D.setDate(D.getDate()+1)}return!1}function Xe(f,u,p,k){return f<k&&p<u}function Se(f,u){return(u.getTime()-f.getTime())/(1e3*60*60)}function Fe(f){if(!f)return"";const u=new Date(f),p=u.getFullYear(),k=u.toLocaleString("en-US",{month:"short"}),D=u.getDate(),w=String(u.getHours()).padStart(2,"0"),l=String(u.getMinutes()).padStart(2,"0");return`${k} ${D}, ${p} ${w}:${l}`}function Ba(f,u,p){const k=[],D=new Date(f.getTime()+u*60*60*1e3);let w;if(p){const l=new Date(p),i=l.getHours(),m=l.getMinutes(),B=f.getHours(),C=f.getMinutes();if(i===B&&m===C&&l.getDate()===f.getDate()&&l.getMonth()===f.getMonth()&&l.getFullYear()===f.getFullYear())if(i!==P&&i!==te)w=new Date(f);else{const b=new Date(f);i===P?b.setHours(te,0,0,0):(b.setDate(b.getDate()+1),b.setHours(P,0,0,0)),w=b}else if(i>=19||i<7){w=new Date(f);const b=f.getHours();b<P?w.setHours(P,0,0,0):b<te?w.setHours(te,0,0,0):(w.setDate(w.getDate()+1),w.setHours(P,0,0,0))}else{const b=new Date(f);f.getHours()<P?b.setHours(P,0,0,0):f.getHours()<te?b.setHours(te,0,0,0):(b.setDate(b.getDate()+1),b.setHours(P,0,0,0)),w=b}}else{const l=f.getHours();w=new Date(f),l<P?w.setHours(P,0,0,0):l<te?w.setHours(te,0,0,0):(w.setDate(w.getDate()+1),w.setHours(P,0,0,0))}for(;w<D;){const l=new Date(w),i=w.getHours();let m;if(i===P)l.setHours(te,0,0,0),m=Ne;else if(i===te)l.setDate(l.getDate()+1),l.setHours(P,0,0,0),m=Ne;else{const B=new Date(w);i<P?B.setHours(P,0,0,0):i<te?B.setHours(te,0,0,0):(B.setDate(B.getDate()+1),B.setHours(P,0,0,0)),l.setTime(Math.min(B.getTime(),D.getTime())),m=Se(w,l)}l>D&&l.setTime(D.getTime()),k.length===0&&m>Ne&&(l.setTime(w.getTime()+Ne*60*60*1e3),l>D&&l.setTime(D.getTime())),k.push({start:new Date(w),end:new Date(l)}),w=new Date(l)}return k}async function Ya(f,u,p){const k=[];try{const D=await Ke({limit:1e3,sortBy:"startAt",sortOrder:"asc"});if(D.success&&D.data)for(const l of D.data){const i=new Date(l.startAt),m=new Date(l.endAt);Xe(f,u,i,m)&&k.push({module:"molekulis",sampler:l.who,startAt:i,endAt:m})}const w=await Ze({limit:1e3,sortBy:"startAt",sortOrder:"asc"});if(w.success&&w.data)for(const l of w.data){const i=new Date(l.startAt),m=new Date(l.endAt);Xe(f,u,i,m)&&k.push({module:"other-jobs",sampler:l.who,startAt:i,endAt:m})}for(const l of p)l.sampler&&k.push({module:"line-sampling",sampler:l.sampler,startAt:new Date(l.start),endAt:new Date(l.end)})}catch(D){console.error("Error fetching conflict assignments:",D)}return k}function lt(f,u,p,k){let D=0;for(const w of u)if(w.sampler===f){const l=new Date(Math.max(w.startAt.getTime(),p.getTime())),i=new Date(Math.min(w.endAt.getTime(),k.getTime()));l<i&&(D+=Se(l,i))}return D}function ut(f,u){let p;for(const k of u)k.sampler===f&&(!p||k.endAt>p)&&(p=new Date(k.endAt));return p}function Wa(f,u,p=gt){return f?Se(f,u)>=p:!0}function dt(f,u,p,k,D,w=!1){if(!f.isActive)return{valid:!1,reason:"Sampler is inactive"};if(Ua(u,f.restrictedDays))return{valid:!1,reason:`Cannot work on restricted days: ${f.restrictedDays.map(i=>["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][i]).join(", ")}`};for(const l of p.conflicts)if(Xe(u.start,u.end,l.startAt,l.endAt))return{valid:!1,reason:`Conflicts with ${l.module} assignment`};if(!w&&!Wa(p.lastShiftEnd,u.start))return{valid:!1,reason:`Insufficient rest: ${(p.lastShiftEnd?Se(p.lastShiftEnd,u.start):0).toFixed(1)}h (min ${gt}h)`};if(f.has24HourRestriction){const l=Se(u.start,u.end),i=p.weeklyHours+l;if(i>it)return{valid:!1,reason:`Weekly limit exceeded: ${p.weeklyHours.toFixed(1)}h + ${l.toFixed(1)}h = ${i.toFixed(1)}h (max ${it}h)`}}return{valid:!0}}function Pa(f,u,p,k,D,w,l,i,m){const B=[],C=[],L=[],b=u.filter(_=>_.isActive);if(b.length===0)return C.push("No active samplers available"),{shifts:f,warnings:B,errors:C,auditLog:L};const S=new Map;b.forEach(_=>S.set(_.name,0));const j=new Map;for(const _ of b){const O=p.filter(N=>N.sampler===_.name);j.set(_.name,{sampler:_,conflicts:O,weeklyHours:lt(_.name,p,k,D),lastShiftEnd:ut(_.name,p)})}const M=[];for(let _=0;_<f.length;_++){const O=f[_],N=Ye(O.start).start,Q=Ye(O.start).end;if(_===0&&w&&l&&i&&m){L.push(`First shift: Checking Office Sampling correlation - Sampler: ${w}`);const H=new Date(i),Y=H.getHours(),F=H.getMinutes(),G=m.getHours(),ee=m.getMinutes(),le=Y===G&&F===ee&&H.getDate()===m.getDate()&&H.getMonth()===m.getMonth()&&H.getFullYear()===m.getFullYear();if(L.push(`First shift: Office Sampling finish: ${H.toISOString()} (${Y}:${F.toString().padStart(2,"0")}), Start Discharge: ${m.toISOString()} (${G}:${ee.toString().padStart(2,"0")}), Match: ${le}`),le&&Y!==P&&Y!==te){const U=w.trim(),E=b.find(ue=>ue.name.trim()===U);if(L.push(`First shift: Looking for sampler "${U}" in active samplers: ${b.map(ue=>ue.name).join(", ")}`),E){L.push(`First shift: Found Office Sampling sampler: ${E.name}`);const ue=Se(new Date(l),H),Oe=Se(O.start,O.end),ce=ue+Oe;if(L.push(`First shift: Checking Office Sampling sampler ${E.name} - Office: ${ue.toFixed(2)}h + Line: ${Oe.toFixed(2)}h = ${ce.toFixed(2)}h total`),ce<=Ne){const we=j.get(E.name);if(we){const me={...we,conflicts:[...we.conflicts,{module:"line-sampling",sampler:E.name,startAt:new Date(l),endAt:H}],lastShiftEnd:H},re=dt(E,O,me,N,Q,!0);if(re.valid){O.sampler=E.name,M.push(O),S.set(E.name,(S.get(E.name)||0)+1),p.push({module:"line-sampling",sampler:E.name,startAt:new Date(O.start),endAt:new Date(O.end)}),me.conflicts.push({module:"line-sampling",sampler:E.name,startAt:new Date(O.start),endAt:new Date(O.end)}),me.lastShiftEnd=new Date(O.end),j.set(E.name,me),L.push(`Shift ${_+1} (${O.start.toISOString()} - ${O.end.toISOString()}): Assigned to ${E.name} (same as Office Sampling, total ${ce.toFixed(2)}h â‰¤ 12h)`);continue}else L.push(`First shift: Office Sampling sampler ${E.name} - ${re.reason}`)}}else L.push(`First shift: Office Sampling sampler ${E.name} - Total hours ${ce.toFixed(2)}h exceeds 12h limit`)}else L.push(`First shift: Office Sampling sampler "${U}" not found in active samplers list`)}else le?(Y===P||Y===te)&&L.push(`First shift: Office Sampling finishes at ${Y}:00 (shift boundary), will assign different sampler`):L.push("First shift: Office Sampling finish time does not match Start Discharge time exactly")}const se=b.map(H=>({sampler:H,availability:j.get(H.name),usage:S.get(H.name)||0,weeklyHours:lt(H.name,p,N,Q),lastShiftEnd:ut(H.name,p)})).sort((H,Y)=>H.usage!==Y.usage?H.usage-Y.usage:H.weeklyHours-Y.weeklyHours);let de=!1;for(const H of se){const Y={...H.availability,weeklyHours:H.weeklyHours,lastShiftEnd:H.lastShiftEnd},F=dt(H.sampler,O,Y);if(F.valid){O.sampler=H.sampler.name,M.push(O),S.set(H.sampler.name,(S.get(H.sampler.name)||0)+1),p.push({module:"line-sampling",sampler:H.sampler.name,startAt:new Date(O.start),endAt:new Date(O.end)}),Y.conflicts.push({module:"line-sampling",sampler:H.sampler.name,startAt:new Date(O.start),endAt:new Date(O.end)}),Y.lastShiftEnd=new Date(O.end),j.set(H.sampler.name,Y),L.push(`Shift ${_+1} (${O.start.toISOString()} - ${O.end.toISOString()}): Assigned to ${H.sampler.name}`),de=!0;break}else L.push(`Shift ${_+1}: ${H.sampler.name} - ${F.reason}`)}de||(M.push({...O,sampler:void 0}),C.push(`Shift ${_+1} (${Fe(O.start.toISOString())} - ${Fe(O.end.toISOString())}): No available sampler`),B.push(`No sampler could be assigned to shift starting at ${Fe(O.start.toISOString())}. Please assign manually.`))}return{shifts:M,warnings:B,errors:C,auditLog:L}}async function Ja(f,u,p,k,D,w,l,i){const m=[],B=[],C=[];try{m.push("=== Starting autogenerate process ===");const L=l!==!1;m.push(`Terminal requires line sampling: ${L}`);const b=new Date(f);if(isNaN(b.getTime()))return{success:!1,errors:["Invalid start discharge date"],auditLog:m};if(!L){if(m.push("Terminal does not require line sampling - generating single manual entry"),!i)return{success:!1,errors:["ETC is required for terminals that do not require line sampling"],auditLog:m};let F;if(typeof i=="string"?i.includes("T")||i.includes("Z")?F=new Date(i):F=new Date(i):F=new Date(i),isNaN(F.getTime()))return m.push(`ERROR: Invalid ETC date: ${i}`),{success:!1,errors:[`Invalid ETC date: ${i}`],auditLog:m};m.push(`ETC input: ${i}`),m.push(`ETC parsed: ${F.toISOString()}`);const G=new Date(F.getTime()-1*60*60*1e3),ee=new Date(G.getTime()+4*60*60*1e3),le=Se(G,ee);m.push(`ETC: ${F.toISOString()}`),m.push(`Calculated Start (ETC - 1h): ${G.toISOString()}`),m.push(`Calculated Finish (Start + 4h): ${ee.toISOString()}`),m.push(`Hours: ${le.toFixed(2)}`);const U=[{who:"",startLineSampling:Fe(G.toISOString()),startLineSamplingRaw:G.toISOString(),finishLineSampling:Fe(ee.toISOString()),finishLineSamplingRaw:ee.toISOString(),hours:`${le.toFixed(2)} hrs`}];return B.push("Sampler must be assigned manually before saving"),m.push("=== Single manual entry generated ==="),{success:!0,data:U,warnings:B,auditLog:m}}const S=p?new Date(p):void 0,j=w?new Date(w):void 0;m.push(`Start Discharge: ${b.toISOString()}`),m.push(`Discharge Time: ${u} hours`),S&&(m.push(`Office Sampling Finish: ${S.toISOString()}`),D&&m.push(`Office Sampling Sampler: ${D}`),j&&m.push(`Office Sampling Start: ${j.toISOString()}`));const M=Ba(b,u,S);m.push(`Generated ${M.length} shifts`);const _=await Be.getSamplers(!0);if(!_.success||!_.data)return{success:!1,errors:["Failed to fetch samplers"],auditLog:m};const O=_.data;m.push(`Found ${O.length} samplers`);const N=Ye(b).start,Q=Ye(b).end;m.push(`Week range: ${N.toISOString()} to ${Q.toISOString()}`);const se=[];if(k)for(const F of k)F.startLineSamplingRaw&&F.finishLineSamplingRaw&&se.push({start:new Date(F.startLineSamplingRaw),end:new Date(F.finishLineSamplingRaw),sampler:F.who||void 0});m.push("Fetching conflicts from other modules...");const de=await Ya(N,Q,se);m.push(`Found ${de.length} conflicting assignments`),m.push("Assigning samplers to shifts...");const H=Pa(M,O,de,N,Q,D,j,S,b);m.push(...H.auditLog),B.push(...H.warnings),C.push(...H.errors);const Y=H.shifts.map(F=>{const G=Se(F.start,F.end);return{who:F.sampler||"",startLineSampling:Fe(F.start.toISOString()),startLineSamplingRaw:F.start.toISOString(),finishLineSampling:Fe(F.end.toISOString()),finishLineSamplingRaw:F.end.toISOString(),hours:`${G.toFixed(2)} hrs`}});return m.push("=== Autogenerate process completed ==="),{success:C.length===0,data:Y,warnings:B.length>0?B:void 0,errors:C.length>0?C:void 0,auditLog:m}}catch(L){const b=L instanceof Error?L.message:"Unknown error";return m.push(`ERROR: ${b}`),console.error("Autogenerate error:",L),{success:!1,errors:[`Autogenerate failed: ${b}`],auditLog:m}}}const za=async f=>{const u=encodeURIComponent(f);return(await We.get(`/sampling-rosters/ref/${u}`)).data},Ga=async f=>(await We.post("/sampling-rosters",f)).data,qa=async(f,u)=>(await We.put(`/sampling-rosters/${f}`,u)).data,Ka=async(f,u)=>(await We.patch(`/sampling-rosters/upsert/${encodeURIComponent(f)}`,u)).data,Za={class:"mt-4 grid grid-cols-1 lg:grid-cols-5 gap-6"},Xa={class:"p-6"},Qa={class:"pb-4 border-b border-gray-200 dark:border-gray-700"},es={class:"relative"},ts={key:0,class:"absolute z-10 mt-1 w-full rounded-lg border border-gray-200 bg-blue-50 shadow-lg dark:border-gray-700 dark:bg-blue-900/20 p-3 mb-1"},as=["onClick"],ss={class:"flex justify-between items-start"},rs={class:"text-sm font-medium text-gray-900 dark:text-white"},ns={class:"text-xs text-gray-500 dark:text-gray-400"},os={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},is={key:0},ls={key:1},us={key:2},ds={key:2,class:"absolute z-10 mt-1 w-full rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-800 p-4"},cs={class:"text-sm text-gray-500 dark:text-gray-400 text-center"},gs={key:3,class:"absolute z-10 mt-1 w-full rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-800 p-4"},fs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ps={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ms={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},hs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},vs={class:"flex items-center justify-end"},ys={class:"flex gap-2"},Ss=["disabled"],ws={class:"p-6"},bs={class:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm dark:border-gray-700 dark:bg-gray-800"},xs={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},ks={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-800"},Ds={key:0,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},$s={class:"px-6 py-4 text-sm text-gray-700 dark:text-gray-300 whitespace-nowrap"},Ts=["value"],Hs={key:1,class:"block"},Ls={class:"px-6 py-4 text-sm text-gray-700 dark:text-gray-300"},Os={class:"px-6 py-4 text-sm text-gray-700 dark:text-gray-300"},Rs={class:"px-6 py-4 text-sm text-gray-700 dark:text-gray-300"},Fs={key:0},Cs={key:1},Ms={class:"whitespace-nowrap px-6 py-4 text-sm"},Is={key:0,class:"flex items-center gap-2"},As=["onClick"],_s=["onClick"],Es={class:"mt-6 mb-4 flex items-center justify-between"},Ns={class:"flex gap-2"},js=["disabled"],Vs={class:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm dark:border-gray-700 dark:bg-gray-800"},Us={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Bs={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-800"},Ys={key:0,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},Ws={class:"px-6 py-4 text-sm text-gray-700 dark:text-gray-300 whitespace-nowrap"},Ps=["value"],Js={key:1,class:"block"},zs={class:"px-6 py-4 text-sm text-gray-700 dark:text-gray-300"},Gs={class:"px-6 py-4 text-sm text-gray-700 dark:text-gray-300"},qs={class:"px-6 py-4 text-sm text-gray-700 dark:text-gray-300"},Ks={key:0},Zs={key:1},Xs={class:"whitespace-nowrap px-6 py-4 text-sm"},Qs={key:0,class:"flex items-center gap-2"},er=["onClick"],tr=["onClick"],pr=ct({__name:"SamplingRoster",setup(f){const u=Ct(),p=A(""),k=A(!1),D=A(!1),w=A([]),l=A(null),i=qe(()=>w.value),m=async()=>{D.value=!0;try{const s=await Wt({limit:5,sortBy:"etb",sortOrder:"desc"});s.success&&s.data&&(w.value=s.data)}catch(s){console.error("Error loading ship nominations:",s)}finally{D.value=!1}},B=async()=>{if(k.value=!0,l.value&&clearTimeout(l.value),!p.value||p.value.trim()===""){await m();return}l.value=setTimeout(async()=>{D.value=!0;try{const s=await Pt(p.value,20);s.success&&s.data&&(w.value=s.data)}catch(s){console.error("Error searching ship nominations:",s),u.error("Error searching ship nominations")}finally{D.value=!1}},500)},C=A([]),L=A(null),b=A({who:"",startOffice:"",finishSampling:"",hours:""}),S=A([]),j=A(null),M=A({who:"",startLineSampling:"",finishLineSampling:"",hours:""}),_=A([]),O=A([]),N=s=>{if(!s)return"";const e=new Date(s),t=e.getFullYear(),r=e.toLocaleString("en-US",{month:"short"}),o=e.getDate(),g=String(e.getHours()).padStart(2,"0"),v=String(e.getMinutes()).padStart(2,"0");return`${r} ${o}, ${t} ${g}:${v}`},Q=s=>{if(!s)return"";const e=new Date(s),t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),g=String(e.getHours()).padStart(2,"0"),v=String(e.getMinutes()).padStart(2,"0");return`${t}-${r}-${o} ${g}:${v}`},se=(s,e)=>((e.getTime()-s.getTime())/(1e3*60*60)).toFixed(2),de=qe(()=>{if(L.value===null)return null;if(!b.value.startOffice||!b.value.finishSampling)return"-";const s=new Date(b.value.startOffice),e=new Date(b.value.finishSampling);return isNaN(s.getTime())||isNaN(e.getTime())?"-":e<=s?"0.00 hrs":`${se(s,e)} hrs`}),H=qe(()=>{if(j.value===null)return null;if(!M.value.startLineSampling||!M.value.finishLineSampling)return"-";const s=new Date(M.value.startLineSampling),e=new Date(M.value.finishLineSampling);return isNaN(s.getTime())||isNaN(e.getTime())?"-":e<=s?"0.00 hrs":`${se(s,e)} hrs`}),Y=s=>{if(!s.sampler||!s.pilotOnBoard){C.value=[];return}const e=new Date(s.pilotOnBoard),t=new Date(e.getTime()+5*60*60*1e3),r=se(e,t);C.value=[{who:s.sampler,startOffice:N(s.pilotOnBoard),startOfficeRaw:e.toISOString(),finishSampling:N(t.toISOString()),finishSamplingRaw:t.toISOString(),hours:`${r} hrs`}]},F=s=>{const e=C.value[s];L.value=s,b.value={who:e.who,startOffice:Q(e.startOfficeRaw),finishSampling:Q(e.finishSamplingRaw),hours:e.hours}},G=async s=>{const e=C.value[s];let t,r;if(b.value.startOffice){if(t=new Date(b.value.startOffice),isNaN(t.getTime())){u.warning("Invalid START OFFICE date format");return}}else t=new Date(e.startOfficeRaw);if(b.value.finishSampling){if(r=new Date(b.value.finishSampling),isNaN(r.getTime())){u.warning("Invalid FINISH SAMPLING date format");return}}else r=new Date(e.finishSamplingRaw);if(isNaN(t.getTime())||isNaN(r.getTime())){u.warning("Please fill in START OFFICE and FINISH SAMPLING");return}if(r<=t){u.warning("FINISH SAMPLING must be after START OFFICE");return}const o=se(t,r),g={who:b.value.who||e.who,startOffice:N(t.toISOString()),startOfficeRaw:t.toISOString(),finishSampling:N(r.toISOString()),finishSamplingRaw:r.toISOString(),hours:`${o} hrs`},v=[...C.value];v[s]=g,C.value=v,L.value=null,b.value={who:"",startOffice:"",finishSampling:"",hours:""},q.value&&await Te(),u.success("Record updated successfully")},ee=()=>{L.value=null,b.value={who:"",startOffice:"",finishSampling:"",hours:""}},le=s=>{const e=S.value[s];j.value=s,M.value={who:e.who,startLineSampling:Q(e.startLineSamplingRaw),finishLineSampling:Q(e.finishLineSamplingRaw),hours:e.hours}},U=(s,e)=>(e.getTime()-s.getTime())/(1e3*60*60),E=(s,e,t,r)=>s<r&&t<e,ue=(s,e,t)=>{for(let r=0;r<S.value.length;r++){if(r===s)continue;const o=S.value[r];if(!o.startLineSamplingRaw||!o.finishLineSamplingRaw)continue;const g=new Date(o.startLineSamplingRaw),v=new Date(o.finishLineSamplingRaw);if(E(e,t,g,v))return!1}return!0},Oe=async(s,e)=>{if(s>=S.value.length-1)return[];let t=null;if(n.value.startDischarge&&n.value.dischargeTimeHours){let g;n.value.startDischarge.includes("T")||n.value.startDischarge.includes("Z")?g=n.value.startDischarge:g=new Date(n.value.startDischarge.replace(" ","T")).toISOString();const v=new Date(g);t=new Date(v.getTime()+n.value.dischargeTimeHours*60*60*1e3)}let r=new Date(e);const o=[];for(let g=s+1;g<S.value.length;g++){const v=S.value[g];if(t&&r>=t)break;let c=new Date(r.getTime()+12*60*60*1e3);t&&c>t&&(c=t);const d=U(r,c);if(o.push({who:v.who,startLineSampling:N(r.toISOString()),startLineSamplingRaw:r.toISOString(),finishLineSampling:N(c.toISOString()),finishLineSamplingRaw:c.toISOString(),hours:`${d.toFixed(2)} hrs`}),r=new Date(c),t&&c>=t)break}if(t&&r<t){const g=O.value.filter(v=>v.isActive).map(v=>v.name);if(g.length>0){const v=[];for(let y=0;y<=s;y++)S.value[y].who&&v.push(S.value[y].who);for(const y of o)y.who&&v.push(y.who);const c=new Map;g.forEach(y=>{c.set(y,v.filter(T=>T===y).length)});const d=[...g].sort((y,T)=>(c.get(y)||0)-(c.get(T)||0));let h=0;for(;r<t;){let y=new Date(r.getTime()+432e5);y>t&&(y=t);const T=U(r,y),I=d[h%d.length];if(o.push({who:I,startLineSampling:N(r.toISOString()),startLineSamplingRaw:r.toISOString(),finishLineSampling:N(y.toISOString()),finishLineSamplingRaw:y.toISOString(),hours:`${T.toFixed(2)} hrs`}),c.set(I,(c.get(I)||0)+1),h++,r=new Date(y),r>=t)break}}}return o},ce=s=>{const e=new Date(s),t=e.getDay(),r=e.getDate()-t+(t===0?-6:1),o=new Date(e.setDate(r));o.setHours(0,0,0,0);const g=new Date(o);return g.setDate(o.getDate()+6),g.setHours(23,59,59,999),{start:o,end:g}},we=(s,e,t)=>{const r=new Date(s),o=new Date(e),g=new Date(r);g.setHours(0,0,0,0);const v=new Date(g);for(;v<=o;){const c=v.getDay();if(t.includes(c))return!0;v.setDate(v.getDate()+1)}return!1},me=(s,e,t,r)=>{for(let o=0;o<S.value.length;o++){if(o===s||o>s)continue;const g=S.value[o];if(!g.startLineSamplingRaw||!g.finishLineSamplingRaw)continue;const v=new Date(g.startLineSamplingRaw),c=new Date(g.finishLineSamplingRaw);if(E(e,t,v,c))return!1}for(let o=0;o<r.length;o++){const g=r[o],v=new Date(g.startLineSamplingRaw),c=new Date(g.finishLineSamplingRaw);if(E(v,c,e,t))return!1;for(let d=o+1;d<r.length;d++){const h=r[d],y=new Date(h.startLineSamplingRaw),T=new Date(h.finishLineSamplingRaw);if(E(v,c,y,T))return!1}for(let d=0;d<s;d++){const h=S.value[d];if(!h.startLineSamplingRaw||!h.finishLineSamplingRaw)continue;const y=new Date(h.startLineSamplingRaw),T=new Date(h.finishLineSamplingRaw);if(E(v,c,y,T))return!1}}return!0},re=A(!1),V=A({molekulisData:null,otherJobsData:null,lastFetch:0,CACHE_DURATION:5*60*1e3}),be=async(s,e,t,r)=>{if(re.value)return{valid:!1,reason:"Validation already in progress"};re.value=!0;const o=O.value.find(c=>c.name===s);if(!o)return re.value=!1,{valid:!1,reason:"Sampler not found"};if(!o.isActive)return re.value=!1,{valid:!1,reason:"Sampler is inactive"};if(we(e,t,o.restrictedDays||[])){const c=(o.restrictedDays||[]).map(d=>["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][d]).join(", ");return re.value=!1,{valid:!1,reason:`Cannot work on restricted days: ${c}`}}re.value=!1;const g=10;for(let c=0;c<S.value.length;c++){if(c===r)continue;const d=S.value[c];if(!d.who||d.who!==s||!d.startLineSamplingRaw||!d.finishLineSamplingRaw)continue;const h=new Date(d.startLineSamplingRaw),y=new Date(d.finishLineSamplingRaw);if(E(e,t,h,y)){const I=U(h,y);return{valid:!1,reason:"Sampler is already assigned to another shift during this time",conflictDetails:{previousShift:{start:h,end:y,duration:`${I.toFixed(1)}h`,source:"Line Sampling"}}}}let T;if(e>=y)T=U(y,e);else if(h>=t)T=U(t,h);else continue;if(T<g){const I=U(h,y);return{valid:!1,reason:`Insufficient rest between shifts: ${T.toFixed(1)}h (minimum ${g}h required)`,conflictDetails:{previousShift:{start:h,end:y,duration:`${I.toFixed(1)}h`,source:"Line Sampling"},restHours:T}}}}const v=24;if(o.has24HourRestriction){const c=ce(e),d=[],h=U(e,t);let y=0;for(let I=0;I<S.value.length;I++){if(I===r)continue;const K=S.value[I];if(!K.who||K.who!==s||!K.startLineSamplingRaw||!K.finishLineSamplingRaw)continue;const oe=new Date(K.startLineSamplingRaw),Z=new Date(K.finishLineSamplingRaw);if(ce(oe).start.getTime()===c.start.getTime()){const ie=new Date(Math.max(oe.getTime(),c.start.getTime())),ge=new Date(Math.min(Z.getTime(),c.end.getTime()));if(ie<ge){const fe=U(ie,ge);y+=fe,d.push({start:oe,end:Z,duration:fe,source:"Line Sampling"})}}}try{const I=c.start,K=c.end,oe=Date.now();if(!V.value.molekulisData||!V.value.otherJobsData||oe-V.value.lastFetch>V.value.CACHE_DURATION){const[Z,ae]=await Promise.all([Ke({limit:100,sortBy:"startAt",sortOrder:"asc"}),Ze({limit:100,sortBy:"startAt",sortOrder:"asc"})]);V.value.molekulisData=Z.success?Z.data:[],V.value.otherJobsData=ae.success?ae.data:[],V.value.lastFetch=oe}if(V.value.molekulisData){for(const Z of V.value.molekulisData)if(Z.who===s){const ae=new Date(Z.startAt),ie=new Date(Z.endAt);if(E(I,K,ae,ie)){const ge=new Date(Math.max(ae.getTime(),I.getTime())),fe=new Date(Math.min(ie.getTime(),K.getTime()));if(ge<fe){const _e=U(ge,fe);y+=_e,d.push({start:ae,end:ie,duration:_e,source:"Molekulis Loading"})}}}}if(V.value.otherJobsData){for(const Z of V.value.otherJobsData)if(Z.who===s){const ae=new Date(Z.startAt),ie=new Date(Z.endAt);if(E(I,K,ae,ie)){const ge=new Date(Math.max(ae.getTime(),I.getTime())),fe=new Date(Math.min(ie.getTime(),K.getTime()));if(ge<fe){const _e=U(ge,fe);y+=_e,d.push({start:ae,end:ie,duration:_e,source:"Other Jobs"})}}}}}catch(I){console.error("Error fetching conflicts for weekly hours validation:",I)}const T=y+h;if(T>v)return{valid:!1,reason:`Weekly limit exceeded: ${T.toFixed(1)}h (max ${v}h)`,conflictDetails:{weeklyHoursDetails:{currentHours:y,proposedHours:h,totalHours:T,maxHours:v,existingShifts:d}}}}try{const c=Date.now();if(!V.value.molekulisData||!V.value.otherJobsData||c-V.value.lastFetch>V.value.CACHE_DURATION){const[d,h]=await Promise.all([Ke({limit:100,sortBy:"startAt",sortOrder:"asc"}),Ze({limit:100,sortBy:"startAt",sortOrder:"asc"})]);V.value.molekulisData=d.success?d.data:[],V.value.otherJobsData=h.success?h.data:[],V.value.lastFetch=c}if(V.value.molekulisData){for(const d of V.value.molekulisData)if(d.who===s){const h=new Date(d.startAt),y=new Date(d.endAt);if(E(e,t,h,y)){const T=U(h,y);return{valid:!1,reason:"Conflicts with Molekulis assignment",conflictDetails:{previousShift:{start:h,end:y,duration:`${T.toFixed(1)}h`,source:"Molekulis Loading"}}}}}}if(V.value.otherJobsData){for(const d of V.value.otherJobsData)if(d.who===s){const h=new Date(d.startAt),y=new Date(d.endAt);if(E(e,t,h,y)){const T=U(h,y);return{valid:!1,reason:"Conflicts with Other Jobs assignment",conflictDetails:{previousShift:{start:h,end:y,duration:`${T.toFixed(1)}h`,source:"Other Jobs"}}}}}}}catch(c){console.error("Error checking conflicts:",c)}return{valid:!0}},Pe=async s=>{const e=S.value[s];let t,r;if(M.value.startLineSampling){if(t=new Date(M.value.startLineSampling),isNaN(t.getTime())){u.warning("Invalid Start Line Sampling date format");return}}else t=new Date(e.startLineSamplingRaw);if(M.value.finishLineSampling){if(r=new Date(M.value.finishLineSampling),isNaN(r.getTime())){u.warning("Invalid Finish Line Sampling date format");return}}else r=new Date(e.finishLineSamplingRaw);if(isNaN(t.getTime())||isNaN(r.getTime())){u.warning("Please fill in Start Line Sampling and Finish Line Sampling");return}if(r<=t){u.warning("Finish Line Sampling must be after Start Line Sampling");return}const o=M.value.who||e.who;if(o){const g=await be(o,t,r,s);if(!g.valid)if(g.conflictDetails){const v=U(t,r);ze.value={samplerName:o,reason:g.reason||"Sampler validation failed",previousShift:g.conflictDetails.previousShift,proposedShift:{start:t,end:r,duration:`${v.toFixed(1)}h`},restHours:g.conflictDetails.restHours,weeklyHoursDetails:g.conflictDetails.weeklyHoursDetails},Ae.value=()=>{Qe(s,t,r)},Ie.value=!0;return}else{u.error(g.reason||"Sampler validation failed");return}}await Qe(s,t,r)},ft=()=>{Ae.value&&(Ae.value(),Ae.value=null),Ie.value=!1},Qe=async(s,e,t)=>{const r=S.value[s],o=U(e,t),g=new Date(r.finishLineSamplingRaw),v=t.getTime()!==g.getTime();let c=[];if(v){if(c=await Oe(s,t),!me(s,e,t,c)){u.error("This shift overlaps with another shift after adjustment. Please adjust the times.");return}for(let d=0;d<c.length;d++){const h=c[d];if(h.who){const y=new Date(h.startLineSamplingRaw),T=new Date(h.finishLineSamplingRaw),I=await be(h.who,y,T,s+1+d);if(!I.valid){u.error(`Shift ${s+2+d}: ${I.reason}`);return}}}}else if(!ue(s,e,t)){u.error("This shift overlaps with another shift. Please adjust the times.");return}if(S.value[s]={who:M.value.who||r.who,startLineSampling:N(e.toISOString()),startLineSamplingRaw:e.toISOString(),finishLineSampling:N(t.toISOString()),finishLineSamplingRaw:t.toISOString(),hours:`${o.toFixed(2)} hrs`},v&&c.length>0){const d=Math.min(c.length,S.value.length-s-1),h=Math.max(0,c.length-d);for(let T=0;T<d;T++){const I=s+1+T;I<S.value.length&&(S.value[I]=c[T])}if(h>0){const T=c.slice(d);for(const I of T)S.value.push(I)}const y=s+1+c.length;if(y<S.value.length){const T=S.value.length-y;S.value.splice(y),h>0&&T>0?u.success(`Line Sampling record updated, ${d} shift(s) adjusted, ${h} shift(s) added, and ${T} shift(s) removed`):h>0?u.success(`Line Sampling record updated, ${d} shift(s) adjusted, and ${h} shift(s) added to reach ETC`):T>0?u.success(`Line Sampling record updated, ${d} shift(s) adjusted, and ${T} shift(s) removed (ETC reached)`):u.success("Line Sampling record updated and subsequent shifts adjusted")}else h>0?u.success(`Line Sampling record updated, ${d} shift(s) adjusted, and ${h} shift(s) added to reach ETC`):u.success("Line Sampling record updated and subsequent shifts adjusted")}else u.success("Line Sampling record updated successfully");j.value=null,M.value={who:"",startLineSampling:"",finishLineSampling:"",hours:""},q.value&&await Te()},pt=()=>{j.value=null,M.value={who:"",startLineSampling:"",finishLineSampling:"",hours:""}},mt=s=>{const[e,t]=s.split(" "),[r,o,g]=e.split("-").map(Number),[v,c]=t.split(":").map(Number);return new Date(r,o-1,g,v,c,0,0)},je=A(!1),ht=async()=>{if(!n.value.startDischarge||n.value.dischargeTimeHours===null||n.value.dischargeTimeHours===void 0){u.warning("Please fill in Start Discharge and Discharge Time (Hrs)");return}je.value=!0;try{let s=!0;if(n.value.terminal)try{const h=await Be.getTerminals();if(h.success&&h.data){const y=h.data.find(T=>T.name===n.value.terminal);y&&(s=y.requiresLineSampling)}}catch(h){console.error("Error fetching terminal info:",h)}const e=C.value.length>0?C.value[0]:void 0,t=e==null?void 0:e.finishSamplingRaw,r=e==null?void 0:e.who,o=e==null?void 0:e.startOfficeRaw;let g,v;n.value.startDischarge.includes("T")||n.value.startDischarge.includes("Z")?(g=new Date(n.value.startDischarge),v=n.value.startDischarge):(g=mt(n.value.startDischarge),v=g.toISOString());let c;s?n.value.etc&&(n.value.etc.includes("T")||n.value.etc.includes("Z")?c=n.value.etc:c=new Date(n.value.etc).toISOString()):c=new Date(g.getTime()+n.value.dischargeTimeHours*60*60*1e3).toISOString();const d=await Ja(v,n.value.dischargeTimeHours,t,S.value.length>0?S.value:void 0,r,o,s,c);d.success&&d.data?(S.value=d.data,u.success(`Generated ${d.data.length} shift(s)`),q.value=!0,await Te()):d.data&&(S.value=d.data)}catch(s){const e=s instanceof Error?s.message:"Unknown error";u.error(`Auto generate failed: ${e}`)}finally{je.value=!1}},vt=()=>{Je.value=!0},yt=()=>{S.value=[],j.value=null,M.value={who:"",startLineSampling:"",finishLineSampling:"",hours:""},q.value=!1,ne.value&&De.value&&Te(),u.success("Line Sampling data cleared")},St=async s=>{try{const e=await za(s);if(e.success&&e.data){const t=e.data;if(n.value.vessel=t.vessel,n.value.berth=t.berth,n.value.amspecRef=t.amspecRef,n.value.pob=t.pob,n.value.etb=t.etb,t.startDischarge){const r=new Date(t.startDischarge),o=r.getFullYear(),g=String(r.getMonth()+1).padStart(2,"0"),v=String(r.getDate()).padStart(2,"0"),c=String(r.getHours()).padStart(2,"0"),d=String(r.getMinutes()).padStart(2,"0");n.value.startDischarge=`${o}-${g}-${v} ${c}:${d}`}return n.value.dischargeTimeHours=t.dischargeTimeHours,n.value.cargo=t.cargo,n.value.surveyor=t.surveyor,n.value.preDischargeTest=t.preDischargeTest||"",n.value.postDischargeTest=t.postDischargeTest||"",L.value!==null&&ee(),C.value=[],t.officeSampling&&t.officeSampling.length>0&&(C.value=t.officeSampling.map(r=>({who:r.who,startOffice:N(r.startOffice),startOfficeRaw:r.startOffice,finishSampling:N(r.finishSampling),finishSamplingRaw:r.finishSampling,hours:`${r.hours.toFixed(2)} hrs`}))),S.value=[],q.value=!1,t.lineSampling&&t.lineSampling.length>0&&(S.value=t.lineSampling.map(r=>({who:r.who,startLineSampling:N(r.startLineSampling),startLineSamplingRaw:r.startLineSampling,finishLineSampling:N(r.finishLineSampling),finishLineSamplingRaw:r.finishLineSampling,hours:`${r.hours.toFixed(2)} hrs`})),q.value=!0),ne.value=!0,De.value=t._id,$e.value={amspecRef:t.amspecRef,vessel:t.vessel,berth:t.berth,pob:t.pob,etb:t.etb,etc:"",terminal:"",startDischarge:t.startDischarge,dischargeTimeHours:t.dischargeTimeHours,cargo:t.cargo,surveyor:t.surveyor,preDischargeTest:t.preDischargeTest||"",postDischargeTest:t.postDischargeTest||"",officeSampling:t.officeSampling.map(r=>({who:r.who,startOffice:r.startOffice,finishSampling:r.finishSampling,hours:r.hours})),lineSampling:t.lineSampling.map(r=>({who:r.who,startLineSampling:r.startLineSampling,finishLineSampling:r.finishLineSampling,hours:r.hours}))},he.value=!1,u.success("Sampling roster loaded from database"),!0}return!1}catch(e){return console.error("Error loading sampling roster:",e),!1}},wt=async s=>{var t;if(C.value=[],S.value=[],q.value=!1,n.value.vessel=s.vesselName,n.value.berth=s.berth||"",n.value.amspecRef=s.amspecReference,n.value.pob=s.pilotOnBoard||"",n.value.etb=s.etb||"",n.value.etc=s.etc||"",n.value.terminal=s.terminal||"",n.value.cargo=((t=s.productTypes)==null?void 0:t.join(", "))||"",n.value.surveyor=s.surveyor||"",s.etb){const r=new Date(s.etb),o=new Date(r.getTime()+3*60*60*1e3),g=o.getFullYear(),v=String(o.getMonth()+1).padStart(2,"0"),c=String(o.getDate()).padStart(2,"0"),d=String(o.getHours()).padStart(2,"0"),h=String(o.getMinutes()).padStart(2,"0");n.value.startDischarge=`${g}-${v}-${c} ${d}:${h}`}else n.value.startDischarge="";n.value.dischargeTimeHours=null,n.value.preDischargeTest=s.chemist||"",n.value.postDischargeTest=s.chemist||"",k.value=!1,p.value=`${s.vesselName} - ${s.amspecReference}`,await St(s.amspecReference)||(L.value!==null&&ee(),Y(s),ne.value=!1,De.value="",$e.value=null,he.value=!1,u.success("Form filled with ship nomination data"))},bt=async s=>{if(s&&s.length>0){const e=new Date(s[0]),t=new Date(e.getTime()+2*60*60*1e3),r=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),g=String(t.getDate()).padStart(2,"0"),v=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0");n.value.etb=`${r}-${o}-${g} ${v}:${c}`;const d=new Date(t.getTime()+3*60*60*1e3),h=d.getFullYear(),y=String(d.getMonth()+1).padStart(2,"0"),T=String(d.getDate()).padStart(2,"0"),I=String(d.getHours()).padStart(2,"0"),K=String(d.getMinutes()).padStart(2,"0");if(n.value.startDischarge=`${h}-${y}-${T} ${I}:${K}`,n.value.dischargeTimeHours&&n.value.dischargeTimeHours>0){const oe=new Date(d.getTime()+n.value.dischargeTimeHours*60*60*1e3),Z=oe.getFullYear(),ae=String(oe.getMonth()+1).padStart(2,"0"),ie=String(oe.getDate()).padStart(2,"0"),ge=String(oe.getHours()).padStart(2,"0"),fe=String(oe.getMinutes()).padStart(2,"0");n.value.etc=`${Z}-${ae}-${ie} ${ge}:${fe}`}q.value&&n.value.pob&&n.value.etb&&await Te(),await Me("pob"),await Me("etb"),n.value.etc&&await Me("etc")}},xt=async s=>{if(s&&s.length>0){const e=new Date(s[0]),t=new Date(e.getTime()+3*60*60*1e3),r=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),g=String(t.getDate()).padStart(2,"0"),v=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0");if(n.value.startDischarge=`${r}-${o}-${g} ${v}:${c}`,n.value.dischargeTimeHours&&n.value.dischargeTimeHours>0){const d=new Date(t.getTime()+n.value.dischargeTimeHours*60*60*1e3),h=d.getFullYear(),y=String(d.getMonth()+1).padStart(2,"0"),T=String(d.getDate()).padStart(2,"0"),I=String(d.getHours()).padStart(2,"0"),K=String(d.getMinutes()).padStart(2,"0");n.value.etc=`${h}-${y}-${T} ${I}:${K}`}q.value&&n.value.etb&&await Te(),await Me("etb")}},kt=async s=>{if(s&&s.length>0){const e=new Date(s[0]);if(n.value.dischargeTimeHours&&n.value.dischargeTimeHours>0){const t=new Date(e.getTime()+n.value.dischargeTimeHours*60*60*1e3),r=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),g=String(t.getDate()).padStart(2,"0"),v=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0");n.value.etc=`${r}-${o}-${g} ${v}:${c}`}q.value&&n.value.startDischarge&&await Te(),await Me("startDischarge")}},Dt=async s=>{if(s&&s.length>0){const e=new Date(s[0]);if(n.value.startDischarge){const t=new Date(n.value.startDischarge);if(e<t){u.warning("ETC must be after Start Discharge"),n.value.etc="";return}}q.value&&n.value.etc&&await Te()}},Me=async s=>{if(n.value.amspecRef)try{const e=await Jt(n.value.amspecRef);if(!e.success||!e.data){console.log("Ship nomination not found for reference:",n.value.amspecRef);return}const t={};switch(s){case"pob":t.pilotOnBoard=n.value.pob;break;case"etb":t.etb=n.value.etb;break;case"etc":t.etc=n.value.etc;break;case"startDischarge":return}await zt(e.data._id,t)}catch(e){console.error(`Error syncing ${s} with Ship Nomination:`,e)}},$t=s=>{switch(s){case"completed":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"in-progress":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";case"approved":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400";case"cancelled":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}},Tt=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});typeof document<"u"&&document.addEventListener("click",s=>{s.target.closest(".relative")||(k.value=!1)});const n=A({vessel:"",berth:"",amspecRef:"",pob:"",etb:"",etc:"",terminal:"",startDischarge:"",dischargeTimeHours:null,cargo:"",surveyor:"",preDischargeTest:"",postDischargeTest:""}),xe={enableTime:!0,dateFormat:"Y-m-d H:i",altInput:!0,altFormat:"F j, Y at H:i",time_24hr:!0,minuteIncrement:15,locale:{firstDayOfWeek:1}},Ht=A([]),ke=A(!1),ne=A(!1),De=A(""),Ve=A(!1),q=A(!1),he=A(!1),Je=A(!1),Ie=A(!1),ze=A(null),Ae=A(null),$e=A(null),et=async()=>(Ve.value=!0,!n.value.vessel||!n.value.berth||!n.value.amspecRef||!n.value.pob||!n.value.etb||!n.value.startDischarge||!n.value.dischargeTimeHours||!n.value.cargo||!n.value.surveyor?(u.warning("Please fill in all required fields"),!1):n.value.dischargeTimeHours<=0?(u.warning("Discharge Time (Hrs) must be greater than 0"),!1):!0),Ge=()=>{let s;n.value.startDischarge.includes("T")||n.value.startDischarge.includes("Z")?s=n.value.startDischarge:s=new Date(n.value.startDischarge.replace(" ","T")).toISOString();const e=C.value.map(r=>({who:r.who,startOffice:r.startOfficeRaw,finishSampling:r.finishSamplingRaw,hours:parseFloat(r.hours.replace(" hrs",""))||0})),t=S.value.map(r=>({who:r.who,startLineSampling:r.startLineSamplingRaw,finishLineSampling:r.finishLineSamplingRaw,hours:parseFloat(r.hours.replace(" hrs",""))||0}));return{amspecRef:n.value.amspecRef,vessel:n.value.vessel,berth:n.value.berth,pob:n.value.pob,etb:n.value.etb,startDischarge:s,dischargeTimeHours:n.value.dischargeTimeHours||0,cargo:n.value.cargo,surveyor:n.value.surveyor,preDischargeTest:n.value.preDischargeTest,postDischargeTest:n.value.postDischargeTest,officeSampling:e,lineSampling:t}},Lt=A(!1),Te=async()=>{if(!(Lt.value||!q.value||!n.value.amspecRef)&&await et())try{const s=Ge(),e=await Ka(n.value.amspecRef,s);e.success&&e.data&&(ne.value=!0,De.value=e.data._id,$e.value=s),he.value=!1}catch(s){console.error("Auto-save error:",s)}},Ot=()=>{if(!$e.value||!ne.value){he.value=!1;return}const s=Ge(),e=JSON.stringify($e.value),t=JSON.stringify(s);he.value=e!==t};st([n,C,S],()=>{ne.value&&Ot()},{deep:!0}),st(()=>n.value.dischargeTimeHours,s=>{if(s&&n.value.startDischarge){const e=new Date(n.value.startDischarge),t=new Date(e.getTime()+s*60*60*1e3),r=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),g=String(t.getDate()).padStart(2,"0"),v=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0");n.value.etc=`${r}-${o}-${g} ${v}:${c}`}});const Rt=async()=>{if(!ke.value){if(ke.value=!0,!await et()){ke.value=!1;return}if(!q.value){u.warning("Please generate Line Sampling first"),ke.value=!1;return}for(let s=0;s<S.value.length;s++){const e=S.value[s];if(!e.who||!e.startLineSamplingRaw||!e.finishLineSamplingRaw)continue;const t=new Date(e.startLineSamplingRaw),r=new Date(e.finishLineSamplingRaw),o=await be(e.who,t,r,s);if(!o.valid)if(o.conflictDetails){const g=U(t,r);ze.value={samplerName:e.who,reason:o.reason||"Sampler validation failed",previousShift:o.conflictDetails.previousShift,proposedShift:{start:t,end:r,duration:`${g.toFixed(1)}h`},restHours:o.conflictDetails.restHours,weeklyHoursDetails:o.conflictDetails.weeklyHoursDetails},Ae.value=()=>{tt()},Ie.value=!0,ke.value=!1;return}else{u.error(`Shift ${s+1}: ${o.reason||"Sampler validation failed"}`),ke.value=!1;return}}await tt()}},tt=async()=>{try{const s=Ge();if(ne.value&&De.value){const e=await qa(De.value,s);e.success&&e.data?($e.value=s,he.value=!1,u.success("Sampling roster updated successfully")):u.error(e.message||"Failed to update sampling roster")}else{const e=await Ga(s);e.success&&e.data?(ne.value=!0,De.value=e.data._id,$e.value=s,he.value=!1,u.success("Sampling roster saved successfully")):u.error(e.message||"Failed to save sampling roster")}}catch(s){console.error("Save error:",s),u.error("Failed to save sampling roster")}finally{ke.value=!1}},at=()=>{n.value={vessel:"",berth:"",amspecRef:"",pob:"",etb:"",etc:"",terminal:"",startDischarge:"",dischargeTimeHours:null,cargo:"",surveyor:"",preDischargeTest:"",postDischargeTest:""},C.value=[],S.value=[],Ve.value=!1,ne.value=!1,De.value="",p.value="",q.value=!1,he.value=!1,$e.value=null},Ft=()=>{at()};return Mt(async()=>{await m();const s=await Be.getSurveyors(!0);s.success&&s.data&&(Ht.value=s.data.map(t=>t.name));const e=await Be.getSamplers(!0);e.success&&e.data&&(_.value=e.data.map(t=>t.name),O.value=e.data)}),(s,e)=>(x(),$(Re,null,[z(_t,null,{default:ye(()=>[z(Et,{pageTitle:"Sampling Roster"}),a("div",Za,[z(nt,{title:"New Sampling Roster",description:"Register a new sampling roster entry",class:"lg:col-span-2"},{default:ye(()=>[a("div",Xa,[a("form",{class:"space-y-6",onKeydown:e[14]||(e[14]=It(At(()=>{},["prevent"]),["enter"]))},[a("div",Qa,[e[26]||(e[26]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"}," Search Ship Nomination ",-1)),a("div",es,[W(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),onInput:B,onFocus:e[1]||(e[1]=t=>k.value=!0),type:"text",class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-white px-4 py-2.5 pr-10 text-sm text-gray-900 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:focus:border-brand-800",placeholder:"Search by vessel name or AmSpec reference..."},null,544),[[ve,p.value]]),e[25]||(e[25]=a("svg",{class:"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),k.value&&!p.value&&i.value.length>0?(x(),$("div",ts,e[23]||(e[23]=[a("p",{class:"text-xs text-blue-700 dark:text-blue-300"}," Showing last 5 ship nominations. Type to search all records. ",-1)]))):J("",!0),k.value&&i.value.length>0?(x(),$("div",{key:1,class:Ue(["absolute z-10 w-full rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-800 max-h-60 overflow-y-auto",p.value?"mt-1":"mt-16"])},[(x(!0),$(Re,null,Ce(i.value,t=>(x(),$("button",{key:t._id,type:"button",onClick:r=>wt(t),class:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-700 last:border-b-0 transition-colors"},[a("div",ss,[a("div",null,[a("p",rs,R(t.vesselName),1),a("p",ns," Ref: "+R(t.amspecReference),1)]),a("span",{class:Ue(["text-xs px-2 py-1 rounded-full",$t(t.status)])},R(t.status||"pending"),3)]),t.berth||t.etb?(x(),$("div",os,[t.berth?(x(),$("span",is,"Berth: "+R(t.berth),1)):J("",!0),t.berth&&t.etb?(x(),$("span",ls," | ")):J("",!0),t.etb?(x(),$("span",us,"ETB: "+R(Tt(t.etb)),1)):J("",!0)])):J("",!0)],8,as))),128))],2)):J("",!0),k.value&&p.value&&i.value.length===0&&!D.value?(x(),$("div",ds,[a("p",cs,' No ship nominations found for "'+R(p.value)+'" ',1)])):J("",!0),D.value?(x(),$("div",gs,e[24]||(e[24]=[a("p",{class:"text-sm text-gray-500 dark:text-gray-400 text-center"}," Loading... ",-1)]))):J("",!0)])]),a("div",null,[e[27]||(e[27]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"},[pe(" Vessel "),a("span",{class:"text-red-500"},"*")],-1)),W(a("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.vessel=t),type:"text",readonly:"",class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-700 cursor-not-allowed dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",placeholder:"Select from Ship Nomination"},null,512),[[ve,n.value.vessel]])]),a("div",fs,[a("div",null,[e[28]||(e[28]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"},[pe(" Berth "),a("span",{class:"text-red-500"},"*")],-1)),W(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.berth=t),type:"text",readonly:"",class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-700 cursor-not-allowed dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",placeholder:"From Ship Nomination"},null,512),[[ve,n.value.berth]])]),a("div",null,[e[29]||(e[29]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"},[pe(" AmSpec Ref "),a("span",{class:"text-red-500"},"*")],-1)),W(a("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.amspecRef=t),type:"text",readonly:"",class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-700 cursor-not-allowed dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",placeholder:"From Ship Nomination"},null,512),[[ve,n.value.amspecRef]])])]),a("div",ps,[a("div",null,[e[30]||(e[30]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"},[pe(" POB "),a("span",{class:"text-red-500"},"*")],-1)),z(X(Le),{modelValue:n.value.pob,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.pob=t),config:xe,onOnChange:bt,class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm text-gray-900 placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:placeholder:text-gray-500 dark:focus:border-brand-800",placeholder:"Select date and time"},null,8,["modelValue"])]),a("div",null,[e[31]||(e[31]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"},[pe(" ETB "),a("span",{class:"text-red-500"},"*")],-1)),z(X(Le),{modelValue:n.value.etb,"onUpdate:modelValue":e[6]||(e[6]=t=>n.value.etb=t),config:xe,onOnChange:xt,class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm text-gray-900 placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:placeholder:text-gray-500 dark:focus:border-brand-800",placeholder:"Select date and time"},null,8,["modelValue"])])]),a("div",ms,[a("div",null,[e[32]||(e[32]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"},[pe(" Start Discharge "),a("span",{class:"text-red-500"},"*")],-1)),z(X(Le),{modelValue:n.value.startDischarge,"onUpdate:modelValue":e[7]||(e[7]=t=>n.value.startDischarge=t),config:xe,onOnChange:kt,class:Ue(["h-11 w-full appearance-none rounded-lg border bg-white px-4 py-2.5 text-sm text-gray-900 focus:outline-hidden focus:ring-3 dark:bg-gray-800 dark:text-white",Ve.value&&!n.value.startDischarge?"border-red-500 focus:ring-red-500/20 dark:border-red-600":"border-gray-300 focus:border-brand-300 focus:ring-brand-500/10 dark:border-gray-700 dark:focus:border-brand-800"]),placeholder:"Auto-calculated (ETB + 3hrs)"},null,8,["modelValue","class"])]),a("div",null,[e[33]||(e[33]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"},[pe(" Discharge Time (Hrs) "),a("span",{class:"text-red-500"},"*")],-1)),W(a("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>n.value.dischargeTimeHours=t),type:"number",min:"0",step:"1",class:Ue(["h-11 w-full appearance-none rounded-lg border bg-white px-4 py-2.5 text-sm text-gray-900 focus:outline-hidden focus:ring-3 dark:bg-gray-800 dark:text-white",Ve.value&&!n.value.dischargeTimeHours?"border-red-500 focus:ring-red-500/20 dark:border-red-600":"border-gray-300 focus:border-brand-300 focus:ring-brand-500/10 dark:border-gray-700 dark:focus:border-brand-800"]),placeholder:"Enter hours"},null,2),[[ve,n.value.dischargeTimeHours,void 0,{number:!0}]])])]),a("div",null,[e[34]||(e[34]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"}," ETC (Estimated Time of Completion) ",-1)),z(X(Le),{modelValue:n.value.etc,"onUpdate:modelValue":e[9]||(e[9]=t=>n.value.etc=t),config:xe,onOnChange:Dt,class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm text-gray-900 placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:placeholder:text-gray-500 dark:focus:border-brand-800",placeholder:"Select date and time"},null,8,["modelValue"])]),a("div",null,[e[35]||(e[35]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"},[pe(" Cargo "),a("span",{class:"text-red-500"},"*")],-1)),W(a("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>n.value.cargo=t),type:"text",readonly:"",class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-700 cursor-not-allowed dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",placeholder:"Desde Ship Nomination"},null,512),[[ve,n.value.cargo]])]),a("div",null,[e[36]||(e[36]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"},[pe(" Surveyor "),a("span",{class:"text-red-500"},"*")],-1)),W(a("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>n.value.surveyor=t),type:"text",readonly:"",class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-700 cursor-not-allowed dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",placeholder:"Desde Ship Nomination"},null,512),[[ve,n.value.surveyor]])]),a("div",hs,[a("div",null,[e[37]||(e[37]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"}," Pre Discharge Testing ",-1)),W(a("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>n.value.preDischargeTest=t),type:"text",readonly:"",class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-700 cursor-not-allowed dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",placeholder:"From Ship Nomination (Chemist)"},null,512),[[ve,n.value.preDischargeTest]])]),a("div",null,[e[38]||(e[38]=a("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"}," Post Discharge Testing ",-1)),W(a("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>n.value.postDischargeTest=t),type:"text",readonly:"",class:"h-11 w-full appearance-none rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-700 cursor-not-allowed dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",placeholder:"From Ship Nomination (Chemist)"},null,512),[[ve,n.value.postDischargeTest]])])]),a("div",vs,[a("div",ys,[a("button",{type:"button",onClick:Rt,disabled:ke.value||!q.value,class:"rounded-lg bg-brand-500 px-6 py-2.5 text-white font-medium hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed"},R(ne.value&&he.value?"Update":ne.value?"Saved":"Save"),9,Ss),ne.value?(x(),$("button",{key:0,type:"button",class:"rounded-lg bg-orange-500 px-6 py-2.5 text-white font-medium hover:bg-orange-600",onClick:Ft}," Cancel Edit ")):J("",!0),a("button",{type:"button",class:"rounded-lg bg-gray-200 px-6 py-2.5 text-gray-900 font-medium hover:bg-gray-300 dark:bg-gray-700 dark:text-white",onClick:at}," Reset ")])])],32)])]),_:1}),z(nt,{title:"Roster",description:"Sampling roster schedule",class:"lg:col-span-3"},{default:ye(()=>[a("div",ws,[e[52]||(e[52]=a("h4",{class:"mb-4 text-lg font-semibold text-gray-800 dark:text-white/90"},"Office Sampling",-1)),a("div",bs,[a("table",xs,[e[44]||(e[44]=a("thead",{class:"bg-gray-50 dark:bg-gray-900"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"Who"),a("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"START OFFICE"),a("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"FINISH SAMPLING"),a("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"HOURS"),a("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"ACTIONS")])],-1)),a("tbody",ks,[C.value.length===0?(x(),$("tr",Ds,e[39]||(e[39]=[a("td",{colspan:"5",class:"px-6 py-4 text-sm text-center text-gray-500 dark:text-gray-400"},"No data available. Select a vessel to populate the table.",-1)]))):J("",!0),(x(!0),$(Re,null,Ce(C.value,(t,r)=>(x(),$("tr",{key:`office-${r}-${t.startOfficeRaw}`,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[a("td",$s,[L.value===r?W((x(),$("select",{key:0,"onUpdate:modelValue":e[15]||(e[15]=o=>b.value.who=o),class:"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm text-gray-900 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:focus:border-brand-800"},[e[40]||(e[40]=a("option",{value:""},"Select sampler",-1)),(x(!0),$(Re,null,Ce(_.value,o=>(x(),$("option",{key:o,value:o},R(o),9,Ts))),128))],512)),[[rt,b.value.who]]):(x(),$("span",Hs,R(t.who||"-"),1))]),a("td",Ls,[W(a("div",null,[(x(),Ee(X(Le),{key:`start-${r}`,modelValue:b.value.startOffice,"onUpdate:modelValue":e[16]||(e[16]=o=>b.value.startOffice=o),config:xe,class:"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm text-gray-900 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:focus:border-brand-800"},null,8,["modelValue"]))],512),[[He,L.value===r]]),W(a("span",null,R(t.startOffice||"-"),513),[[He,L.value!==r]])]),a("td",Os,[W(a("div",null,[(x(),Ee(X(Le),{key:`finish-${r}`,modelValue:b.value.finishSampling,"onUpdate:modelValue":e[17]||(e[17]=o=>b.value.finishSampling=o),config:xe,class:"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm text-gray-900 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:focus:border-brand-800"},null,8,["modelValue"]))],512),[[He,L.value===r]]),W(a("span",null,R(t.finishSampling||"-"),513),[[He,L.value!==r]])]),a("td",Rs,[L.value===r?(x(),$("span",Fs,R(de.value),1)):(x(),$("span",Cs,R(t.hours||"-"),1))]),a("td",Ms,[L.value===r?(x(),$("div",Is,[a("button",{onClick:o=>G(r),class:"rounded-lg p-1.5 text-green-600 hover:bg-green-50 dark:text-green-400 dark:hover:bg-green-900/20 transition-all duration-200",title:"Save"},e[41]||(e[41]=[a("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]),8,As),a("button",{onClick:ee,class:"rounded-lg p-1.5 text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20 transition-all duration-200",title:"Cancel"},e[42]||(e[42]=[a("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])):(x(),$("button",{key:1,onClick:o=>F(r),class:"rounded-lg p-2 text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/20 transition-all duration-200",title:"Edit"},e[43]||(e[43]=[a("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,_s))])]))),128))])])]),a("div",Es,[e[45]||(e[45]=a("h4",{class:"text-lg font-semibold text-gray-800 dark:text-white/90"},"Line Sampling",-1)),a("div",Ns,[S.value.length>0?(x(),$("button",{key:0,type:"button",onClick:vt,class:"rounded-lg bg-gray-200 px-4 py-2 text-sm font-medium text-gray-900 hover:bg-gray-300 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600 transition-colors"}," Clear ")):J("",!0),a("button",{type:"button",onClick:ht,disabled:je.value||!n.value.startDischarge||!n.value.dischargeTimeHours,class:"rounded-lg bg-brand-500 px-4 py-2 text-sm font-medium text-white hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},R(je.value?"Generating...":"Auto generate"),9,js)])]),a("div",Vs,[a("table",Us,[e[51]||(e[51]=a("thead",{class:"bg-gray-50 dark:bg-gray-900"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"Who"),a("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"Start"),a("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"Finish"),a("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"Hours"),a("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"ACTIONS")])],-1)),a("tbody",Bs,[S.value.length===0?(x(),$("tr",Ys,e[46]||(e[46]=[a("td",{colspan:"5",class:"px-6 py-4 text-sm text-center text-gray-500 dark:text-gray-400"},"No data available.",-1)]))):J("",!0),(x(!0),$(Re,null,Ce(S.value,(t,r)=>(x(),$("tr",{key:`line-${r}-${t.startLineSamplingRaw}`,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[a("td",Ws,[j.value===r?W((x(),$("select",{key:0,"onUpdate:modelValue":e[18]||(e[18]=o=>M.value.who=o),class:"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm text-gray-900 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:focus:border-brand-800"},[e[47]||(e[47]=a("option",{value:""},"Select sampler",-1)),(x(!0),$(Re,null,Ce(_.value,o=>(x(),$("option",{key:o,value:o},R(o),9,Ps))),128))],512)),[[rt,M.value.who]]):(x(),$("span",Js,R(t.who||"-"),1))]),a("td",zs,[W(a("div",null,[(x(),Ee(X(Le),{key:`start-line-${r}`,modelValue:M.value.startLineSampling,"onUpdate:modelValue":e[19]||(e[19]=o=>M.value.startLineSampling=o),config:xe,class:"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm text-gray-900 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:focus:border-brand-800"},null,8,["modelValue"]))],512),[[He,j.value===r]]),W(a("span",null,R(t.startLineSampling||"-"),513),[[He,j.value!==r]])]),a("td",Gs,[W(a("div",null,[(x(),Ee(X(Le),{key:`finish-line-${r}`,modelValue:M.value.finishLineSampling,"onUpdate:modelValue":e[20]||(e[20]=o=>M.value.finishLineSampling=o),config:xe,class:"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm text-gray-900 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:focus:border-brand-800"},null,8,["modelValue"]))],512),[[He,j.value===r]]),W(a("span",null,R(t.finishLineSampling||"-"),513),[[He,j.value!==r]])]),a("td",qs,[j.value===r?(x(),$("span",Ks,R(H.value),1)):(x(),$("span",Zs,R(t.hours||"-"),1))]),a("td",Xs,[j.value===r?(x(),$("div",Qs,[a("button",{onClick:o=>Pe(r),class:"rounded-lg p-1.5 text-green-600 hover:bg-green-50 dark:text-green-400 dark:hover:bg-green-900/20 transition-all duration-200",title:"Save"},e[48]||(e[48]=[a("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]),8,er),a("button",{onClick:pt,class:"rounded-lg p-1.5 text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20 transition-all duration-200",title:"Cancel"},e[49]||(e[49]=[a("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])):(x(),$("button",{key:1,onClick:o=>le(r),class:"rounded-lg p-2 text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/20 transition-all duration-200",title:"Edit"},e[50]||(e[50]=[a("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,tr))])]))),128))])])])])]),_:1})])]),_:1}),z(Nt,{isOpen:Je.value,title:"Clear Line Sampling?",message:"Are you sure you want to clear all Line Sampling shifts? This action cannot be undone.",variant:"warning",confirmText:"Clear All",onConfirm:yt,onClose:e[21]||(e[21]=t=>Je.value=!1)},null,8,["isOpen"]),z(ja,{isOpen:Ie.value,conflictData:ze.value,onOverride:ft,onClose:e[22]||(e[22]=t=>Ie.value=!1)},null,8,["isOpen","conflictData"])],64))}});export{pr as default};
