import{d as oe,c as g,a as _,l as Y,p as y,f as c,u as f,e,g as ke,t as i,n as C,r as d,o as te,x as he,w as ae,z as we,b as I,h as H,v as _e,i as Ce,F as De}from"./index-BEwWJCfq.js";import{_ as Se}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Bo6EfaUO.js";import{_ as Oe}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-DwZBASTA.js";import{_ as re}from"./ComponentCard.vue_vue_type_script_setup_true_lang-4gcYoayb.js";import{C as L}from"./component-C085N_PL.js";import{d as $e,C as Ve}from"./ConfirmationModal-pn1y-z0k.js";import{u as Ae,c as Te,l as je,d as Me}from"./otherJobsService-Gcc3EfgY.js";import{Y as Ie,h as se,G as Be,V as Fe,S as Ee}from"./transition-BQFT3kHB.js";import{_ as Je}from"./SingleSelect-DyXcDeUp.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./InfoCircleIcon-BcdoysoI.js";const Pe={class:"fixed inset-0 overflow-y-auto"},He={class:"flex min-h-full items-center justify-center p-4 text-center"},Ue={class:"flex items-center justify-between"},We={class:"mt-4 space-y-4"},Re={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Ne={class:"text-sm text-gray-900 dark:text-gray-100"},ze={class:"text-sm text-gray-900 dark:text-gray-100"},Le={class:"text-sm text-gray-900 dark:text-gray-100"},Ye={class:"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-line"},Ge=oe({__name:"ViewOtherJobModal",props:{isOpen:{type:Boolean},item:{}},emits:["close"],setup(G,{emit:k}){const o=G,V=k,u=()=>{V("close")},B=g(()=>{var s;return(s=o.item)!=null&&s.when?new Date(o.item.when).toLocaleDateString("en-AU",{day:"2-digit",month:"2-digit",year:"numeric"}):"-"}),F=n=>n<10?`0${n}`:`${n}`,A=n=>{if(!n)return"--:--";const s=new Date(n);return`${F(s.getHours())}:${F(s.getMinutes())}`},h=g(()=>{var p,w;if(!((p=o.item)!=null&&p.startAt)||!((w=o.item)!=null&&w.endAt))return 0;const n=new Date(o.item.startAt).getTime(),s=new Date(o.item.endAt).getTime();return+(Math.max(0,s-n)/36e5).toFixed(0)}),b=g(()=>o.item?`${A(o.item.startAt)} - ${A(o.item.endAt)} (${h.value}h)`:"-"),m=g(()=>{var p,w;const n=new Date,s=(p=o.item)!=null&&p.startAt?new Date(o.item.startAt):null,x=(w=o.item)!=null&&w.endAt?new Date(o.item.endAt):null;return s&&n<s?"pending":s&&x&&n>=s&&n<=x?"in-progress":x&&n>x?"completed":"pending"}),U=n=>n==="completed"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":n==="in-progress"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400";return(n,s)=>(_(),Y(f(Ee),{appear:"",show:n.isOpen,as:"template"},{default:y(()=>[c(f(Ie),{as:"div",class:"relative z-[999999]",onClose:u},{default:y(()=>[c(f(se),{as:"template",enter:"duration-200 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-150 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:y(()=>s[0]||(s[0]=[e("div",{class:"fixed inset-0 bg-black/40"},null,-1)])),_:1}),e("div",Pe,[e("div",He,[c(f(se),{as:"template",enter:"duration-200 ease-out","enter-from":"opacity-0 translate-y-2 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"duration-150 ease-in","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-2 sm:scale-95"},{default:y(()=>[c(f(Be),{class:"w-full max-w-2xl transform overflow-hidden rounded-xl bg-white p-6 text-left align-middle shadow-xl transition-all dark:bg-gray-800"},{default:y(()=>{var x,p;return[e("div",Ue,[c(f(Fe),{class:"text-lg font-semibold text-gray-900 dark:text-white"},{default:y(()=>s[1]||(s[1]=[ke("Other Job Details")])),_:1}),e("button",{onClick:u,class:"rounded p-2 text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700"},s[2]||(s[2]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",We,[e("div",Re,[e("div",null,[s[3]||(s[3]=e("div",{class:"text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400"},"Date",-1)),e("div",Ne,i(B.value),1)]),e("div",null,[s[4]||(s[4]=e("div",{class:"text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400"},"Surveyor",-1)),e("div",ze,i(((x=n.item)==null?void 0:x.who)||"-"),1)]),e("div",null,[s[5]||(s[5]=e("div",{class:"text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400"},"Status",-1)),e("span",{class:C(["inline-flex rounded-full px-2.5 py-0.5 text-xs font-medium",U(m.value)])},i(m.value),3)]),e("div",null,[s[6]||(s[6]=e("div",{class:"text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400"},"Shift",-1)),e("div",Le,i(b.value),1)])]),e("div",null,[s[7]||(s[7]=e("div",{class:"text-xs uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-1"},"Description",-1)),e("div",Ye,i(((p=n.item)==null?void 0:p.description)||"-"),1)])]),e("div",{class:"mt-6 flex justify-end gap-2"},[e("button",{type:"button",onClick:u,class:"rounded-lg border border-gray-300 px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700"},"Close")])]}),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}}),qe={class:"mt-4 grid grid-cols-1 lg:grid-cols-2 gap-6"},Ke={class:"p-6 space-y-6"},Qe={class:"space-y-2"},Xe={key:0,class:"text-xs text-red-600 dark:text-red-500"},Ze={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end"},et=["value"],tt={class:"flex items-center justify-end"},at={class:"flex gap-2"},rt=["disabled"],st={class:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm dark:border-gray-700 dark:bg-gray-800"},ot={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700"},nt={class:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300"},lt={class:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300"},dt={class:"flex items-center gap-1"},it=["disabled"],ut={class:"px-2"},gt=["disabled"],ct={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},pt={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-800"},vt={class:"px-6 py-4 text-sm text-gray-700 dark:text-gray-300"},mt={class:"px-6 py-4 text-sm text-gray-700 dark:text-gray-300"},xt={class:"px-6 py-4 text-sm text-gray-700 dark:text-gray-300"},bt={class:"px-6 py-4"},yt={class:"whitespace-nowrap px-6 py-4 text-sm"},ft={class:"flex items-center gap-2"},kt=["onClick"],ht=["onClick"],wt=["onClick"],_t={key:0},Bt=oe({__name:"OtherJobs",setup(G){const k=d(""),o=d(!1),V=g(()=>!k.value.trim()),u=d(""),B=g(()=>!u.value),F={enableTime:!1,dateFormat:"Y-m-d",altInput:!0,altFormat:"F j, Y",locale:{firstDayOfWeek:1}},A=d([]),h=d(""),b=d(""),m=d(""),U=g(()=>A.value.map(a=>({value:a,label:a}))),n={enableTime:!0,noCalendar:!0,dateFormat:"H:i",altInput:!0,altFormat:"H:i",time_24hr:!0,minuteIncrement:15},s=(a,t)=>{if(!a||!t)return null;const[r,l,X]=a.split("-").map(z=>parseInt(z)),[Z,ee]=t.split(":").map(z=>parseInt(z));return!r||!l||!X||Z===void 0||ee===void 0?null:new Date(r,l-1,X,Z,ee,0,0)},x=g(()=>{const a=s(u.value,b.value),t=s(u.value,m.value);if(!a||!t)return"0.00";const r=t.getTime()-a.getTime();return r>0?(r/36e5).toFixed(2):"0.00"}),p=g(()=>!h.value),w=g(()=>!b.value),q=g(()=>!m.value);te(async()=>{const a=await $e.getSamplers(!0);a.success&&a.data&&(A.value=a.data.map(t=>t.name))});const D=he(),T=d(!1),ne=()=>(o.value=!0,B.value||V.value||p.value||w.value||q.value?(D.warning("Please complete required fields: When, Description, Who, Start, End"),!1):!0),W=()=>{u.value="",k.value="",h.value="",b.value="",m.value="",o.value=!1,M.value=!1,J.value=""},le=async()=>{if(!T.value){if(T.value=!0,!ne()){T.value=!1;return}try{const a=s(u.value,b.value),t=s(u.value,m.value),r={when:u.value,description:k.value.trim(),who:h.value,startAt:a?a.toISOString():"",endAt:t?t.toISOString():""};if(M.value&&J.value){const l=await Ae(J.value,r);if(!l.success)throw new Error(l.message||"Update failed");D.success("Other job updated")}else{const l=await Te(r);if(!l.success)throw new Error(l.message||"Create failed");D.success("Other job saved")}await O(),W()}catch{D.error("Failed to save")}finally{T.value=!1}}},R=d([]),v=d(1),S=d(10),E=d(0),j=d(0),de=g(()=>E.value===0?0:(v.value-1)*S.value+1),ie=g(()=>Math.min(v.value*S.value,E.value)),O=async()=>{const a=await je({page:v.value,limit:S.value,sortBy:"when",sortOrder:"desc"});a.success&&a.data&&(R.value=a.data,E.value=a.total??a.count??0,j.value=a.pages??Math.ceil((a.total??0)/S.value))},ue=()=>{v.value=1,O()},ge=()=>{v.value>1&&(v.value--,O())},ce=()=>{v.value<j.value&&(v.value++,O())},pe=a=>a?new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",K=a=>{if(a.status)return a.status;const t=new Date,r=a.startAt?new Date(a.startAt):null,l=a.endAt?new Date(a.endAt):null;return r&&t<r?"pending":r&&l&&t>=r&&t<=l?"in-progress":l&&t>l?"completed":"pending"},ve=a=>a==="completed"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":a==="in-progress"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400",M=d(!1),J=d(""),me=a=>{M.value=!0,J.value=a._id,u.value=a.when?new Date(a.when).toISOString().slice(0,10):"",k.value=a.description,h.value=a.who;const t=r=>{if(!r)return"";const l=new Date(r);return`${String(l.getHours()).padStart(2,"0")}:${String(l.getMinutes()).padStart(2,"0")}`};b.value=t(a.startAt),m.value=t(a.endAt),o.value=!1},$=d(!1),P=d(null),xe=a=>{P.value=a,$.value=!0},be=async()=>{if(!P.value){$.value=!1;return}const a=await Me(P.value._id);a.success?(D.success("Other job deleted"),await O()):D.error(a.message||"Failed to delete"),$.value=!1,P.value=null};te(async()=>{await O()});const N=d(!1),Q=d(null),ye=a=>{Q.value=a,N.value=!0},fe=()=>{W()};return(a,t)=>(_(),Y(Se,null,{default:y(()=>[c(Oe,{pageTitle:"Other Jobs"}),e("div",qe,[c(re,{title:"New Other Job",description:"Register an auxiliary job"},{default:y(()=>[e("div",Ke,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"},"When",-1)),c(f(L),{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=r=>u.value=r),config:F,class:C(["h-11 w-full appearance-none rounded-lg border bg-white px-4 py-2.5 text-sm text-gray-900 focus:outline-hidden focus:ring-3 dark:bg-gray-800 dark:text-white",o.value&&B.value?"border-red-500 focus:ring-red-500/20 dark:border-red-600":"border-gray-300 focus:border-brand-300 focus:ring-brand-500/10 dark:border-gray-700 dark:focus:border-brand-800"]),placeholder:"Select date"},null,8,["modelValue","class"])]),e("div",Qe,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-900 dark:text-white"},"Job Description",-1)),ae(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=r=>k.value=r),onBlur:t[2]||(t[2]=r=>o.value=!0),rows:"6",class:C(["w-full rounded-lg border bg-white px-4 py-2.5 text-sm text-gray-900 focus:outline-hidden focus:ring-3 dark:bg-gray-800 dark:text-white",o.value&&V.value?"border-red-500 focus:ring-red-500/20 dark:border-red-600":"border-gray-300 focus:border-brand-300 focus:ring-brand-500/10 dark:border-gray-700 dark:focus:border-brand-800"]),placeholder:"Write the job description..."},null,34),[[we,k.value]]),o.value&&V.value?(_(),I("p",Xe,"Please enter a message in the textarea.")):H("",!0)]),e("div",Ze,[e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"},"Who",-1)),e("div",{class:C(o.value&&p.value?"[&>*]:!border-red-500 [&>*]:focus:!ring-red-500/20 dark:[&>*]:!border-red-600":"")},[c(Je,{modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=r=>h.value=r),options:U.value,placeholder:"Select sampler"},null,8,["modelValue","options"])],2)]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"},"Start",-1)),c(f(L),{modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=r=>b.value=r),config:n,class:C(["h-11 w-full appearance-none rounded-lg border bg-white px-4 py-2.5 text-sm text-gray-900 focus:outline-hidden focus:ring-3 dark:border-gray-700 dark:bg-gray-800 dark:text-white",o.value&&w.value?"border-red-500 focus:ring-red-500/20 dark:border-red-600":"border-gray-300 focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800"]),placeholder:"Select time"},null,8,["modelValue","class"])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"},"End",-1)),c(f(L),{modelValue:m.value,"onUpdate:modelValue":t[5]||(t[5]=r=>m.value=r),config:n,class:C(["h-11 w-full appearance-none rounded-lg border bg-white px-4 py-2.5 text-sm text-gray-900 focus:outline-hidden focus:ring-3 dark:border-gray-700 dark:bg-gray-800 dark:text-white",o.value&&q.value?"border-red-500 focus:ring-red-500/20 dark:border-red-600":"border-gray-300 focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800"]),placeholder:"Select time"},null,8,["modelValue","class"])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-900 dark:text-white mb-2"},"Total Hours",-1)),e("input",{value:x.value,disabled:"",class:"h-11 w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-700 cursor-not-allowed dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"},null,8,et)])]),e("div",tt,[e("div",at,[e("button",{type:"button",onClick:le,disabled:T.value,class:"rounded-lg bg-brand-500 px-6 py-2.5 text-white font-medium hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed"},i(M.value?"Update":"Save"),9,rt),M.value?(_(),I("button",{key:0,type:"button",class:"rounded-lg bg-orange-500 px-6 py-2.5 text-white font-medium hover:bg-orange-600",onClick:fe},"Cancel Edit")):H("",!0),e("button",{type:"button",class:"rounded-lg bg-gray-200 px-6 py-2.5 text-gray-900 font-medium hover:bg-gray-300 dark:bg-gray-700 dark:text-white",onClick:W},"Reset")])])])]),_:1}),c(re,{title:"Other Jobs",description:"Recent records"},{default:y(()=>[e("div",st,[e("div",ot,[e("div",nt,[t[16]||(t[16]=e("span",null,"Rows per page:",-1)),ae(e("select",{class:"rounded-md border border-gray-300 bg-white px-2 py-1 text-sm text-gray-900 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-800 dark:text-white dark:focus:border-brand-800","onUpdate:modelValue":t[6]||(t[6]=r=>S.value=r),onChange:ue},t[15]||(t[15]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),544),[[_e,S.value,void 0,{number:!0}]])]),e("div",lt,[e("span",null,"Showing "+i(de.value)+"–"+i(ie.value)+" of "+i(E.value),1),e("div",dt,[e("button",{class:"rounded-md px-2 py-1 border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 dark:border-gray-600 dark:text-gray-300",disabled:v.value===1,onClick:ge},"‹",8,it),e("span",ut,"Page "+i(v.value)+" / "+i(j.value),1),e("button",{class:"rounded-md px-2 py-1 border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 dark:border-gray-600 dark:text-gray-300",disabled:v.value===j.value||j.value===0,onClick:ce},"›",8,gt)])])]),e("table",ct,[t[21]||(t[21]=e("thead",{class:"bg-gray-50 dark:bg-gray-900"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"Date"),e("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"Who"),e("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"Total Hours"),e("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"Status"),e("th",{class:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-700 dark:text-gray-300"},"Actions")])],-1)),e("tbody",pt,[(_(!0),I(De,null,Ce(R.value,r=>(_(),I("tr",{key:r._id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[e("td",vt,i(pe(r.when)),1),e("td",mt,i(r.who),1),e("td",xt,i(r.hours.toFixed(2)),1),e("td",bt,[e("span",{class:C(["inline-flex rounded-full px-2.5 py-0.5 text-xs font-medium",ve(K(r))])},i(K(r)),3)]),e("td",yt,[e("div",ft,[e("button",{onClick:l=>ye(r),class:"rounded-lg p-2 text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/20 transition-all duration-200",title:"View"},t[17]||(t[17]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)]),8,kt),e("button",{onClick:l=>me(r),class:"rounded-lg p-2 text-green-600 hover:bg-green-50 dark:text-green-400 dark:hover:bg-green-900/20 transition-all duration-200",title:"Edit"},t[18]||(t[18]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,ht),e("button",{onClick:l=>xe(r),class:"rounded-lg p-2 text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20 transition-all duration-200",title:"Delete"},t[19]||(t[19]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,wt)])])]))),128)),R.value.length?H("",!0):(_(),I("tr",_t,t[20]||(t[20]=[e("td",{colspan:"6",class:"px-6 py-6 text-center text-sm text-gray-500 dark:text-gray-400"},"No records yet",-1)])))])])])]),_:1}),$.value?(_(),Y(Ve,{key:0,isOpen:$.value,title:"Delete Other Job",message:"Are you sure you want to delete this job? This action cannot be undone.",variant:"danger",confirmText:"Delete",onClose:t[7]||(t[7]=r=>$.value=!1),onConfirm:be},null,8,["isOpen"])):H("",!0),c(Ge,{isOpen:N.value,item:Q.value,onClose:t[8]||(t[8]=r=>N.value=!1)},null,8,["isOpen","item"])])]),_:1}))}});export{Bt as default};
