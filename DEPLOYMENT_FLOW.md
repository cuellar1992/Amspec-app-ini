# ๐ Flujo de Despliegue en Digital Ocean App Platform

## Diagrama del Proceso

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    REPOSITORIO GITHUB                          โ
โ              cuellar1992/AmSpec-App (main)                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โ Push a main branch
                            โ
                            โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              DIGITAL OCEAN APP PLATFORM                          โ
โ                                                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  Detecta .do/app.yaml                                    โ  โ
โ  โ  - Frontend: static_sites (amspec-frontend)             โ  โ
โ  โ  - Backend: services (amspec-backend)                    โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                            โ                                     โ
โ                            โผ                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ              DESPLIEGUE PARALELO                          โ  โ
โ  โ                                                            โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ      โ  โ
โ  โ  โ   FRONTEND BUILD    โ  โ   BACKEND START      โ      โ  โ
โ  โ  โ                     โ  โ                     โ      โ  โ
โ  โ  โ 1. npm install      โ  โ 1. npm install       โ      โ  โ
โ  โ  โ 2. npm run build    โ  โ    (en /server)      โ      โ  โ
โ  โ  โ 3. Deploy dist/     โ  โ 2. npm start         โ      โ  โ
โ  โ  โ                     โ  โ 3. Conecta MongoDB   โ      โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโ      โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                            โ                                     โ
โ                            โผ                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ              VARIABLES DE ENTORNO                          โ  โ
โ  โ                                                            โ  โ
โ  โ  Frontend:                                                โ  โ
โ  โ  - VITE_API_URL = ${amspec-backend.PUBLIC_URL}/api        โ  โ
โ  โ                                                            โ  โ
โ  โ  Backend:                                                 โ  โ
โ  โ  - MONGODB_URI (de App-Level Variables)                   โ  โ
โ  โ  - JWT_SECRET (de App-Level Variables)                    โ  โ
โ  โ  - JWT_REFRESH_SECRET (de App-Level Variables)            โ  โ
โ  โ  - FRONTEND_URL = ${amspec-frontend.PUBLIC_URL}           โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                            โ                                     โ
โ                            โผ                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ              APLICACIรN DESPLEGADA                         โ  โ
โ  โ                                                            โ  โ
โ  โ  Frontend URL:                                            โ  โ
โ  โ  https://amspec-frontend-xxxxx.ondigitalocean.app         โ  โ
โ  โ                                                            โ  โ
โ  โ  Backend URL:                                             โ  โ
โ  โ  https://amspec-backend-xxxxx.ondigitalocean.app          โ  โ
โ  โ  - Health: /health                                         โ  โ
โ  โ  - API: /api/*                                            โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
                            โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    MONGODB ATLAS                                โ
โ              (Base de Datos Externa)                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Flujo de Peticiones

```
โโโโโโโโโโโโโโโ
โ   Usuario   โ
โโโโโโโโฌโโโโโโโ
       โ
       โ HTTPS Request
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  FRONTEND (Static Site)             โ
โ  https://amspec-frontend-xxx.app    โ
โ                                     โ
โ  - Vue.js App                       โ
โ  - Archivos estรกticos (HTML/CSS/JS) โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ API Request (VITE_API_URL)
       โ /api/auth/login
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  BACKEND (Service)                   โ
โ  https://amspec-backend-xxx.app     โ
โ                                     โ
โ  - Express.js Server                โ
โ  - JWT Authentication               โ
โ  - Rate Limiting                    โ
โ  - CORS                             โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ MongoDB Query
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  MONGODB ATLAS                      โ
โ  (Cloud Database)                   โ
โ                                     โ
โ  - Users Collection                 โ
โ  - Ship Nominations                 โ
โ  - Sampling Rosters                 โ
โ  - etc.                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Variables de Entorno - Flujo de Resoluciรณn

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  DIGITAL OCEAN APP PLATFORM                                  โ
โ                                                              โ
โ  1. App-Level Variables (Configuradas manualmente)          โ
โ     - MONGODB_URI                                            โ
โ     - JWT_SECRET                                             โ
โ     - JWT_REFRESH_SECRET                                     โ
โ                                                              โ
โ  2. Component-Level Variables (Del app.yaml)                โ
โ     Frontend:                                                โ
โ     - VITE_API_URL = ${amspec-backend.PUBLIC_URL}/api       โ
โ                                                              โ
โ     Backend:                                                 โ
โ     - FRONTEND_URL = ${amspec-frontend.PUBLIC_URL}           โ
โ     - NODE_ENV = production                                  โ
โ     - PORT = 5000                                            โ
โ                                                              โ
โ  3. Digital Ocean Auto-Generated                             โ
โ     - amspec-backend.PUBLIC_URL                              โ
โ     - amspec-frontend.PUBLIC_URL                              โ
โ                                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## Cronologรญa del Despliegue

```
Tiempo    Acciรณn
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
0:00      Push a GitHub main branch
0:01      Digital Ocean detecta el cambio
0:02      Inicia build del Frontend y Backend en paralelo
          
          Frontend:
0:03      npm install (instala dependencias)
0:05      npm run build (compila Vue.js)
0:08      Deploy de archivos estรกticos a CDN
          
          Backend:
0:03      npm install (instala dependencias en /server)
0:05      npm start (inicia servidor)
0:06      Valida variables de entorno
0:07      Conecta a MongoDB Atlas
0:08      Inicia Express server
0:09      Health check disponible
          
0:10      โ Despliegue completo
0:11      Frontend y Backend comunicรกndose
```

## Estructura de URLs

```
Frontend (Static Site):
https://amspec-frontend-xxxxx.ondigitalocean.app
โโโ / (index.html)
โโโ /signin
โโโ /signup
โโโ /dashboard
โโโ ... (SPA routes)

Backend (Service):
https://amspec-backend-xxxxx.ondigitalocean.app
โโโ / (API info)
โโโ /health (Health check)
โโโ /api
    โโโ /auth
    โ   โโโ /login
    โ   โโโ /register
    โ   โโโ /refresh
    โโโ /ship-nominations
    โโโ /molekulis-loading
    โโโ /other-jobs
    โโโ ... (otros endpoints)
```

## Configuraciรณn de CORS

```
Frontend Request
    โ
    โ Origin: https://amspec-frontend-xxx.app
    โ
    โผ
Backend recibe request
    โ
    โ Verifica CORS:
    โ FRONTEND_URL = https://amspec-frontend-xxx.app
    โ
    โผ
โ Request permitido (si Origin coincide con FRONTEND_URL)
โ Request bloqueado (si Origin no coincide)
```

## Monitoreo y Health Checks

```
Digital Ocean Health Check
    โ
    โ GET /health cada 30 segundos
    โ
    โผ
Backend responde:
{
  "status": "ok",
  "timestamp": "2024-01-01T12:00:00Z",
  "uptime": 3600,
  "environment": "production"
}
    โ
    โผ
โ Aplicaciรณn saludable
โ Si falla 3 veces consecutivas โ Reinicio automรกtico
```

